function formElementsSettingsModule(e,t){this.backboneView=e,this.$el=e.$el,this.model=e.model,this.formDataKey="data",this.paymentRequiredKey="paymentRequired",this.paypalItemCostKey="paypalItemCost",this.discountTypeKey="discountType";for(var i in t)this[i]=t[i];this.initialize()}function formElementsViewModule(e,t){this.backboneView=e,this.$el=e.$el,this.model=e.model,this.formDataKey="data",this.paymentRequiredKey="paymentRequired";for(var i in t)this[i]=t[i];this.initialize()}function usingHtml5Datetime(){return isMobile()}function mailingListChosen(e){debug()("Called",e),APP_MODEL.set({mailchimpList:e.list_id,mailchimpListName:e.name}),$('[name="subscribeToMailchimp"]').prop("checked",!0),APP_MODEL.attributes.data.map(function(e,t){"email"===e.type&&(APP_MODEL.attributes.data[t].subscribeToMailchimp=!0)}),APP_SETTINGS.initializeCheckboxes(),APP_SETTINGS.initializeWixCheckboxes(),APP_SETTINGS.updateConditionals()}function loadView(e){var t="undefined"!=typeof e&&void 0!=e.use_backup_content?e.use_backup_content:!1,i="undefined"!=typeof e&&void 0!=e.app_el?e.app_el:$("#appView");for(var a in GLOBALS)window[a]=GLOBALS[a];var n=META.app_type+"AppModel";if(META.soft_alias&&(window[n]=window[META.app_namespace+"AppModel"]),APP_MODEL=new window[n],t)for(var a in BACKUP_CONTENT)"undefined"!=BACKUP_CONTENT[a]&&APP_MODEL.set(a,BACKUP_CONTENT[a]);else for(var a in CONTENT)"undefined"!=CONTENT[a]&&APP_MODEL.set(a,CONTENT[a]);APP_MODEL.meta={};for(var a in META)"undefined"!=META[a]&&(APP_MODEL.meta[a]=META[a]);APP_MODEL.afterMount(),META.password_protected_template&&$("body").append(META.password_protected_template),APP_VIEW=new window[META.app_namespace+"AppView"]({el:"#"+i.attr("id"),model:APP_MODEL}),$.inArray(META.external_id_type,["weebly-integrated","design-editor","webydo"])>-1&&(debug()("Updating through local storage"),setInterval(function(){if("undefined"!=typeof META){var e=localStorage.getItem("powr_data_"+META.id);if(void 0!=e&&null!=e&&"null"!=e){e=JSON.parse(e);{APP_MODEL.get("locals")}for(var t in e.content)if("locals"==t)for(var i in e.content.locals)APP_MODEL.attributes.locals[i]=e.content.locals[i];else APP_MODEL.attributes[t]=e.content[t];"undefined"!=typeof PLATFORM_DATA&&loadPlatformData(PLATFORM_DATA,{render:!1}),APP_VIEW.render(),localStorage.removeItem("powr_data_"+META.id)}}},100)),loadViewInitializers()}function loadViewInitializers(){"free"==META.premium_status&&$(".loadingWrapper").show(),META.edit_me&&("jimdo"==META.external_id_type&&$("#editMe").css({marginTop:"20px"}),$("#editMe").fadeIn("fast")),$('link[rel="canonical"]').attr("href",baseUri()+"/plugins/view?id="+META.id),META.admin_debug_panel&&$("body").append(META.admin_debug_panel),"undefined"==typeof _gaq&&(_gaq=[]);var e="UA-46595223-1";_gaq.push(["powr._setAccount",e]),_gaq.push(["powr._trackPageview"]),analyticsEvent(META.id.toString(),"view",""),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();var t=getURLParameter("mode");"page"==t?$("#appView").css({margin:"5% 15%"}):"scroll"==t||$("html").css({overflow:"hidden"})}function loadViewListeners(){function e(e){function t(){PARENT_ORIGIN=e.origin,IFRAME_INDEX=i.data.iframe_index,"undefined"==typeof APP_MODEL?setTimeout(t,50):APP_MODEL.setLocals({parent_origin:e.origin,iframe_index:i.data.iframe_index,parent_window_height:i.data.parent_window_height,parent_window_width:i.data.parent_window_width})}debug()("View received settings, evt is",e);try{var i=JSON.parse(e.data)}catch(a){return debug()("Couldn't json parse data: ",a),!1}var i=JSON.parse(e.data);if("loaded"==i.message){debug()("View received settings loaded. Evt origin is ",e.origin),t();var n={message:"viewLoaded",data:{iframe_index:i.data.iframe_index}};parent.postMessage(JSON.stringify(n),e.origin),"undefined"!=typeof APP_VIEW&&APP_VIEW.postSizeToSocket()}if("loadView"==i.message)META=i.data.meta,GLOBALS=i.data.globals,CONTENT=i.data.content,loadView(),APP_MODEL.setLocals({parent_origin:e.origin,iframe_index:i.data.iframe_index});else if("showEdit"==i.message)$("#editMe, .adminAppInfo").fadeIn();else if("hideEdit"==i.message)$("#editMe, .adminAppInfo").hide();else if("update"==i.message){{APP_MODEL.get("locals")}for(var r in i.data.content)if("locals"==r)for(var o in i.data.content.locals)APP_MODEL.attributes.locals[o]=i.data.content.locals[o];else APP_MODEL.attributes[r]=i.data.content[r];APP_VIEW.render()}else"triggerPowrPopupClick"==i.message||"exitDocument"==i.message?APP_VIEW.openModal&&APP_VIEW.openModal(i.message):"platformData"==i.message&&(loadPlatformData(i.data),PLATFORM_DATA=i.data)}function t(){$("#editMe").popover({html:!0,trigger:"hover",delay:{hide:850},viewport:{selector:"#apps-view",padding:0},template:'<div class="popover" role="tooltip" style="font-size: 12px;margin-top: 5px;z-index: 10000000;"><div class="arrow"></div><div class="popover-content"></div></div>'})}try{APP_SOCKET=new easyXDM.Socket({onMessage:function(e){var t=JSON.parse(e);debug()("Message in app:",t),t.action&&"activate"==t.action?$("#editMe").fadeIn():t.action&&"deactivate"==t.action&&$("#editMe").fadeOut()}})}catch(i){debug()("Could not establish socket connection: "+i)}return window.addEventListener?window.addEventListener("message",e):window.attachEvent("onmessage",e),$(document).on("click","#editMe",function(){"undefined"!=typeof SETTINGS_WINDOW&&SETTINGS_WINDOW.close();var e=Math.round(.9*screen.height),t=400,i=Math.round(screen.width-t-.1*screen.width),a="/apps/"+META.app_type+"/settings?id="+META.true_id+"&demo_mode="+META.demo_mode;void 0!=META.template&&(a+="&template="+META.template),SETTINGS_WINDOW=window.open(a,"POWr Editor","width="+t+",height="+e+",top=-1000,left="+i+",location=no,status=no","false")}),void 0==$(window).popover?void setTimeout(function(){t()},2e3):(t(),void $(window).on("beforeunload",function(){return APP_MODEL.get("locals").isDirty?"You have unsaved work with a POWr Plugin! If you leave this page you will lose any unsaved changes.":void 0}))}function loadPlatformData(e,t){if(debug()("Trying to load platform data"),"undefined"==typeof APP_MODEL)return void setTimeout(function(){loadPlatformData(e)},100);"undefined"==typeof t&&(t={render:!0}),debug()("Loading platform data",e);var i=!1,a={};for(var n in e.content)"undefined"!=typeof APP_MODEL.defaults()[n]&&APP_MODEL.attributes[n]!=e.content[n]&&(debug()("Default key: "+APP_MODEL.defaults()[n]),debug()("Response key: "+e.content[n]),"px"==(APP_MODEL.defaults()[n]+"").slice(-2)&&"px"!=(e.content[n]+"").slice(-2)?(APP_MODEL.attributes[n]=e.content[n]+"px",a[n]=e.content[n]+"px"):(APP_MODEL.attributes[n]=e.content[n],a[n]=e.content[n]),i=!0);i&&t.render&&APP_VIEW.render()}function initializeWix(){"undefined"!=typeof WIX_LOCAL_APP_TYPE&&(wixLocalAppModel=window[WIX_LOCAL_APP_TYPE+"AppModel"],localDevAppModel=wixLocalAppModel,wixIeLocalAppModel=wixLocalAppModel),VIEW_MODE=Wix.Utils.getViewMode(),loadView("site"!=VIEW_MODE?{use_backup_content:!0}:{use_backup_content:!1}),Wix.addEventListener(Wix.Events.SETTINGS_UPDATED,function(e){debug()("Wix settings updated:",e),APP_MODEL.attributes=e,APP_MODEL.meta.saved=!0,APP_VIEW.render()}),Wix.addEventListener(Wix.Events.SITE_PUBLISHED,function(){debug()("site published"),APP_MODEL.doSave({post_params:{wix_published:!0}})}),Wix.addEventListener(Wix.Events.COMPONENT_DELETED,function(){debug()("app deleted"),APP_MODEL.doSave({post_params:{wix_deleted:!0}})}),"site"==VIEW_MODE&&Wix.currentMember(function(e){debug()("member details: ",e),e&&e.email&&setTimeout(function(){deliverHash(e.email)},2e3)})}function PowrHideShow(){this.show=this.show||function(){return this.$body.show(),this},this.hide=this.hide||function(){return this.$body.hide(),this}}function PowrEvents(){this._events={},this.on=function(e,t){return e in this._events?this._events[e].push(t):this._events[e]=[t],this},this.trigger=function(e){return e in this._events?this._events[e].forEach(function(t){t(this,e)}.bind(this)):console.warn("Unregistered event [ "+e+" ] called. For POWr Module: [ "+this.moduleName+" ]"),this},this.triggerFor=function(e,t){var i=function(i){t&&t.call(this,e,i),this.trigger(e)}.bind(this);return i}}function PowrRegister(e){$.extend(this,e);var t=[{_tag:"pwr-mod-attr",behavior:function(e,t){var i="$"+e;i in this?this.newElem=this[i].add(t):this[i]=t}},{_tag:"pwr-handler",behavior:function(e,t){var i=t.attr("pwr-handler-event");i&&i.length?i.split(",").forEach(function(i){t.on(i,this._exec_handler(e))}.bind(this)):t.on("click",this._exec_handler(e))}},{_tag:"pwr-event",behavior:function(e){this._events||PowrEvents.call(this),this.trigger(e)}}],i=function(e,i){t.forEach(function(t){var a=t.behavior,n=e.attr(t._tag);n&&a.call(i,n,e)})};return!this.$body&&this._html?this.$body=$(this._html):this.$body||(this.$body=$($("[pwr-mod-name="+this.ModuleName+"]").html())),this.$body.length?(this.length=this.$body.length,this.splice=this.$body.splice.bind(this.$body),this[0]=this.$body.get(0),this._exec_handler=this._exec_handler||function(e){var t=this;return function(i){t._handlers&&t._handlers[e](i,this,t)}}.bind(this),this.register=this.register||function(e){var t,a=this,n="[pwr]",r=e||this.$body;t=r.findAndSelf(n),t.each(function(){var e=$(this);i(e,a)})},this.register(),void(this.registerChild=function(){})):console.warn("Could not find template for POWr Module: [ "+this.ModuleName+" ]")}function PowrStrap(e){this.registeredModules=[PowrRegister,PowrEvents,PowrHideShow],this._register=function(e){this.registeredModules.push(e),this._make()},this._make=function(){this.registeredModules.forEach(function(t){t.call(this,e)}.bind(this))},this._make()}function POWrDatePickerComponent(e){if(PowrStrap.call(this,e),this.formatString=this.formatString||"MM-DD-YYYY",this.using_native_inputs)return this.handleNativeInputs();if(this.$datePickerContainer.length){this.$datePickerContainer.datepicker({showOn:"focus",showButtonPanel:!0,dateFormat:"mm-dd-yy",onSelect:this._exec_handler("jqueryCalChange").bind(this)}).on("click",function(){$(this).datepicker("show")});var t=$(document);this.$datePickerContainer.on("keydown",function(){t.bind("mousemove.datepickertrigger",function(){t.unbind("mousemove.datepickertrigger"),this._handlers.jqueryCalChange(null,null,this)}.bind(this))}.bind(this))}this.dateState=this.initial_date||null,this.setDateInput()}function POWrTimePickerComponent(e){return PowrStrap.call(this,e),this.using_native_inputs?this.handleNativeInputs():void this.setTimeState(this.timeState)}function POWrDateTimeComponentWithIncrementer(e){PowrStrap.call(this,e),this.dateTimeState=moment_custom(this.initial_date||new Date),this.timeComponent=new POWrTimePickerComponent({using_native_inputs:this.using_native_inputs,use_local:this.use_local,$body:this.timeSelectEls||null}).on("change",function(e){var t=e.timeState;this.dateTimeState.hour(t.hours(null,this.use_local),this.use_local),this.dateTimeState.minute(t.minutes(null,this.use_local),this.use_local),this.dateTimeState.second(t.seconds(null,this.use_local),this.use_local),this._setHiddenInput()}.bind(this)),this.dateComponent=new POWrDatePickerComponent({using_native_inputs:this.using_native_inputs,initial_date:this.dateTimeState,use_local:this.use_local,$body:this.dateSelectEls||null}).on("change",function(e){this.dateTimeState.year(e.dateState.year(null,this.use_local),this.use_local),this.dateTimeState.month(e.dateState.month(null,this.use_local),this.use_local),this.dateTimeState.date(e.dateState.date(null,this.use_local),this.use_local),this._setHiddenInput()}.bind(this));this.formatString=this.formatString||"MM-DD-YYYY",this.setFormat(this.formatString),this._init()}!function(e){"use strict";e.fn.konami=function(t){var i,a,n;return i=e.extend({},e.fn.konami.defaults,t),this.each(function(){a=[],e(window).keyup(function(e){n=e.keyCode||e.which,i.code.length>a.push(n)||(i.code.length<a.length&&a.shift(),i.code.toString()===a.toString()&&i.cheat())})})},e.fn.konami.defaults={code:[38,38,40,40,37,39,37,39,66,65],cheat:null}}(jQuery),function(e,t,i,a,n,r){function o(e,t){var i=typeof e[t];return"function"==i||!("object"!=i||!e[t])||"unknown"==i}function s(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function d(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!_(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var i=navigator.plugins[e].description;i&&!_(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(C=i.match(/\d+/g))}if(!C){var a;try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),C=Array.prototype.slice.call(a.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),a=null}catch(n){}}if(!C)return!1;var r=parseInt(C[0],10),o=parseInt(C[1],10);return I=r>9&&o>0,!0}function u(){if(!V){V=!0;for(var e=0;e<Y.length;e++)Y[e]();Y.length=0}}function c(e,t){return V?void e.call(t):void Y.push(function(){e.call(t)})}function p(){var e=parent;if(""!==R)for(var t=0,i=R.split(".");t<i.length;t++)e=e[i[t]];return e.easyXDM}function h(t){return e.easyXDM=j,R=t,R&&(H="easyXDM_"+R.replace(".","_")+"_"),B}function m(e){return e.match(F)[3]}function f(e){return e.match(F)[4]||""}function g(e){var t=e.toLowerCase().match(F),i=t[2],a=t[3],n=t[4]||"";return("http:"==i&&":80"==n||"https:"==i&&":443"==n)&&(n=""),i+"//"+a+n}function v(e){if(e=e.replace(L,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":i.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=i.protocol+"//"+i.host+t+e}for(;N.test(e);)e=e.replace(N,"");return e}function y(e,t){var i="",a=e.indexOf("#");-1!==a&&(i=e.substring(a),e=e.substring(0,a));var n=[];for(var o in t)t.hasOwnProperty(o)&&n.push(o+"="+r(t[o]));return e+(U?"#":-1==e.indexOf("?")?"?":"&")+n.join("&")+i}function _(e){return"undefined"==typeof e}function b(e,t,i){var a;for(var n in t)t.hasOwnProperty(n)&&(n in e?(a=t[n],"object"==typeof a?b(e[n],a,i):i||(e[n]=t[n])):e[n]=t[n]);return e}function w(){var e=t.body.appendChild(t.createElement("form")),i=e.appendChild(t.createElement("input"));i.name=H+"TEST"+P,T=i!==e.elements[i.name],t.body.removeChild(e)}function k(e){_(T)&&w();var i;T?i=t.createElement('<iframe name="'+e.props.name+'"/>'):(i=t.createElement("IFRAME"),i.name=e.props.name),i.id=i.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(b(i.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var a=e.props.src;if(e.props.src="javascript:false",b(i,e.props),i.border=i.frameBorder=0,i.allowTransparency=!0,e.container.appendChild(i),e.onLoad&&E(i,"load",e.onLoad),e.usePost){var n,r=e.container.appendChild(t.createElement("form"));if(r.target=i.name,r.action=a,r.method="POST","object"==typeof e.usePost)for(var o in e.usePost)e.usePost.hasOwnProperty(o)&&(T?n=t.createElement('<input name="'+o+'"/>'):(n=t.createElement("INPUT"),n.name=o),n.value=e.usePost[o],r.appendChild(n));r.submit(),r.parentNode.removeChild(r)}else i.src=a;return e.props.src=a,i}function D(e,t){"string"==typeof e&&(e=[e]);for(var i,a=e.length;a--;)if(i=e[a],i=new RegExp("^"==i.substr(0,1)?i:"^"+i.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),i.test(t))return!0;return!1}function M(a){var n,r=a.protocol;if(a.isHost=a.isHost||_(z.xdm_p),U=a.hash||!1,a.props||(a.props={}),a.isHost)a.remote=v(a.remote),a.channel=a.channel||"default"+P++,a.secret=Math.random().toString(16).substring(2),_(r)&&(r=g(i.href)==g(a.remote)?"4":o(e,"postMessage")||o(t,"postMessage")?"1":a.swf&&o(e,"ActiveXObject")&&d()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":a.remoteHelper?"2":"0");else if(a.channel=z.xdm_c.replace(/["'<>\\]/g,""),a.secret=z.xdm_s,a.remote=z.xdm_e.replace(/["'<>\\]/g,""),r=z.xdm_p,a.acl&&!D(a.acl,a.remote))throw new Error("Access denied for "+a.remote);switch(a.protocol=r,r){case"0":if(b(a,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),a.isHost){if(!a.local){for(var s,l=i.protocol+"//"+i.host,u=t.body.getElementsByTagName("img"),c=u.length;c--;)if(s=u[c],s.src.substring(0,l.length)===l){a.local=s.src;break}a.local||(a.local=e)}var p={xdm_c:a.channel,xdm_p:0};a.local===e?(a.usePolling=!0,a.useParent=!0,a.local=i.protocol+"//"+i.host+i.pathname+i.search,p.xdm_e=a.local,p.xdm_pa=1):p.xdm_e=v(a.local),a.container&&(a.useResize=!1,p.xdm_po=1),a.remote=y(a.remote,p)}else b(a,{channel:z.xdm_c,remote:z.xdm_e,useParent:!_(z.xdm_pa),usePolling:!_(z.xdm_po),useResize:a.useParent?!1:a.useResize});n=[new B.stack.HashTransport(a),new B.stack.ReliableBehavior({}),new B.stack.QueueBehavior({encode:!0,maxLength:4e3-a.remote.length}),new B.stack.VerifyBehavior({initiate:a.isHost})];break;case"1":n=[new B.stack.PostMessageTransport(a)];break;case"2":a.remoteHelper=v(a.remoteHelper),n=[new B.stack.NameTransport(a),new B.stack.QueueBehavior,new B.stack.VerifyBehavior({initiate:a.isHost})];break;case"3":n=[new B.stack.NixTransport(a)];break;case"4":n=[new B.stack.SameOriginTransport(a)];break;case"5":n=[new B.stack.FrameElementTransport(a)];break;case"6":C||d(),n=[new B.stack.FlashTransport(a)]}return n.push(new B.stack.QueueBehavior({lazy:a.lazy,remove:!0})),n}function S(e){for(var t,i={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},a=0,n=e.length;n>a;a++)t=e[a],b(t,i,!0),0!==a&&(t.down=e[a-1]),a!==n-1&&(t.up=e[a+1]);return t}function x(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var T,C,I,E,$,A=this,P=Math.floor(1e4*Math.random()),O=Function.prototype,F=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,N=/[\-\w]+\/\.\.\//,L=/([^:])\/\//g,R="",B={},j=e.easyXDM,H="easyXDM_",U=!1;if(o(e,"addEventListener"))E=function(e,t,i){e.addEventListener(t,i,!1)},$=function(e,t,i){e.removeEventListener(t,i,!1)};else{if(!o(e,"attachEvent"))throw new Error("Browser not supported");E=function(e,t,i){e.attachEvent("on"+t,i)},$=function(e,t,i){e.detachEvent("on"+t,i)}}var W,V=!1,Y=[];if("readyState"in t?(W=t.readyState,V="complete"==W||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==W||"interactive"==W)):V=!!t.body,!V){if(o(e,"addEventListener"))E(t,"DOMContentLoaded",u);else if(E(t,"readystatechange",function(){"complete"==t.readyState&&u()}),t.documentElement.doScroll&&e===top){var q=function(){if(!V){try{t.documentElement.doScroll("left")}catch(e){return void a(q,1)}u()}};q()}E(e,"load",u)}var z=function(e){e=e.substring(1).split("&");for(var t,i={},a=e.length;a--;)t=e[a].split("="),i[t[0]]=n(t[1]);return i}(/xdm_e=/.test(i.search)?i.search:i.hash),K=function(){var e={},t={a:[1,2,3]},i='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===i?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===i&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=i.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(K=function(){return e},e):null)};b(B,{version:"2.4.17.1",query:z,stack:{},apply:b,getJSONObject:K,whenReady:c,noConflict:h}),B.DomHelper={on:E,un:$,requiresJSON:function(i){s(e,"JSON")||t.write('<script type="text/javascript" src="'+i+'"></script>')}},function(){var e={};B.Fn={set:function(t,i){e[t]=i},get:function(t,i){var a=e[t];return i&&delete e[t],a}}}(),B.Socket=function(e){var t=S(M(e).concat([{incoming:function(t,i){e.onMessage(t,i)},callback:function(t){e.onReady&&e.onReady(t)}}])),i=g(e.remote);this.origin=g(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,i)},t.init()},B.Rpc=function(e,t){if(t.local)for(var i in t.local)if(t.local.hasOwnProperty(i)){var a=t.local[i];"function"==typeof a&&(t.local[i]={method:a})}var n=S(M(e).concat([new B.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=g(e.remote),this.destroy=function(){n.destroy()},n.init()},B.stack.SameOriginTransport=function(e){var t,n,r,o;return t={outgoing:function(e,t,i){r(e),i&&i()},destroy:function(){n&&(n.parentNode.removeChild(n),n=null)},onDOMReady:function(){o=g(e.remote),e.isHost?(b(e.props,{src:y(e.remote,{xdm_e:i.protocol+"//"+i.host+i.pathname,xdm_c:e.channel,xdm_p:4}),name:H+e.channel+"_provider"}),n=k(e),B.Fn.set(e.channel,function(e){return r=e,a(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,o)}})):(r=p().Fn.get(e.channel,!0)(function(e){t.up.incoming(e,o)}),a(function(){t.up.callback(!0)},0))},init:function(){c(t.onDOMReady,t)}}},B.stack.FlashTransport=function(e){function n(e){a(function(){o.up.incoming(e,l)},0)}function r(i){var a=e.swf+"?host="+e.isHost,n="easyXDM_swf_"+Math.floor(1e4*Math.random());B.Fn.set("flash_loaded"+i.replace(/[\-.]/g,"_"),function(){B.stack.FlashTransport[i].swf=d=u.firstChild;for(var e=B.stack.FlashTransport[i].queue,t=0;t<e.length;t++)e[t]();e.length=0}),e.swfContainer?u="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(u=t.createElement("div"),b(u.style,I&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(u));var r="callback=flash_loaded"+i.replace(/[\-.]/g,"_")+"&proto="+A.location.protocol+"&domain="+m(A.location.href)+"&port="+f(A.location.href)+"&ns="+R;u.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+n+"' data='"+a+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+a+"'></param><param name='flashvars' value='"+r+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+r+"' allowScriptAccess='always' wmode='transparent' src='"+a+"' height='1' width='1'></embed></object>"}var o,s,l,d,u;return o={outgoing:function(t,i,a){d.postMessage(e.channel,t.toString()),a&&a()},destroy:function(){try{d.destroyChannel(e.channel)}catch(t){}d=null,s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){l=e.remote,B.Fn.set("flash_"+e.channel+"_init",function(){a(function(){o.up.callback(!0)})}),B.Fn.set("flash_"+e.channel+"_onMessage",n),e.swf=v(e.swf);var t=m(e.swf),u=function(){B.stack.FlashTransport[t].init=!0,d=B.stack.FlashTransport[t].swf,d.createChannel(e.channel,e.secret,g(e.remote),e.isHost),e.isHost&&(I&&e.swfNoThrottle&&b(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),b(e.props,{src:y(e.remote,{xdm_e:g(i.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:H+e.channel+"_provider"}),s=k(e))};B.stack.FlashTransport[t]&&B.stack.FlashTransport[t].init?u():B.stack.FlashTransport[t]?B.stack.FlashTransport[t].queue.push(u):(B.stack.FlashTransport[t]={queue:[u]},r(t))},init:function(){c(o.onDOMReady,o)}}},B.stack.PostMessageTransport=function(t){function n(e){if(e.origin)return g(e.origin);if(e.uri)return g(e.uri);if(e.domain)return i.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function r(e){var i=n(e);i==d&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&o.up.incoming(e.data.substring(t.channel.length+1),i)}var o,s,l,d;return o={outgoing:function(e,i,a){l.postMessage(t.channel+" "+e,i||d),a&&a()},destroy:function(){$(e,"message",r),s&&(l=null,s.parentNode.removeChild(s),s=null)},onDOMReady:function(){if(d=g(t.remote),t.isHost){var n=function(i){i.data==t.channel+"-ready"&&(l="postMessage"in s.contentWindow?s.contentWindow:s.contentWindow.document,$(e,"message",n),E(e,"message",r),a(function(){o.up.callback(!0)},0))};E(e,"message",n),b(t.props,{src:y(t.remote,{xdm_e:g(i.href),xdm_c:t.channel,xdm_p:1}),name:H+t.channel+"_provider"}),s=k(t)}else E(e,"message",r),l="postMessage"in e.parent?e.parent:e.parent.document,l.postMessage(t.channel+"-ready",d),a(function(){o.up.callback(!0)},0)},init:function(){c(o.onDOMReady,o)}}},B.stack.FrameElementTransport=function(n){var r,o,s,l;return r={outgoing:function(e,t,i){s.call(this,e),i&&i()},destroy:function(){o&&(o.parentNode.removeChild(o),o=null)},onDOMReady:function(){l=g(n.remote),n.isHost?(b(n.props,{src:y(n.remote,{xdm_e:g(i.href),xdm_c:n.channel,xdm_p:5}),name:H+n.channel+"_provider"}),o=k(n),o.fn=function(e){return delete o.fn,s=e,a(function(){r.up.callback(!0)},0),function(e){r.up.incoming(e,l)}}):(t.referrer&&g(t.referrer)!=z.xdm_e&&(e.top.location=z.xdm_e),s=e.frameElement.fn(function(e){r.up.incoming(e,l)}),r.up.callback(!0))},init:function(){c(r.onDOMReady,r)}}},B.stack.NameTransport=function(e){function t(t){var i=e.remoteHelper+(s?"#_3":"#_2")+e.channel;l.contentWindow.sendMessage(t,i)}function i(){s?2!==++u&&s||o.up.callback(!0):(t("ready"),o.up.callback(!0))}function n(e){o.up.incoming(e,h)}function r(){p&&a(function(){p(!0)},0)}var o,s,l,d,u,p,h,m;return o={outgoing:function(e,i,a){p=a,t(e)},destroy:function(){l.parentNode.removeChild(l),l=null,s&&(d.parentNode.removeChild(d),d=null)},onDOMReady:function(){s=e.isHost,u=0,h=g(e.remote),e.local=v(e.local),s?(B.Fn.set(e.channel,function(t){s&&"ready"===t&&(B.Fn.set(e.channel,n),i())}),m=y(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),b(e.props,{src:m+"#"+e.channel,name:H+e.channel+"_provider"}),d=k(e)):(e.remoteHelper=e.remote,B.Fn.set(e.channel,n));var t=function(){var n=l||this;$(n,"load",t),B.Fn.set(e.channel+"_load",r),function o(){"function"==typeof n.contentWindow.sendMessage?i():a(o,50)}()};l=k({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){c(o.onDOMReady,o)}}},B.stack.HashTransport=function(t){function i(e){if(f){var i=t.remote+"#"+h++ +"_"+e;(l||!v?f.contentWindow:f).location=i}}function n(e){p=e,s.up.incoming(p.substring(p.indexOf("_")+1),y)}function r(){if(m){var e=m.location.href,t="",i=e.indexOf("#");-1!=i&&(t=e.substring(i)),t&&t!=p&&n(t)}}function o(){d=setInterval(r,u)}var s,l,d,u,p,h,m,f,v,y;return s={outgoing:function(e){i(e)},destroy:function(){e.clearInterval(d),(l||!v)&&f.parentNode.removeChild(f),f=null},onDOMReady:function(){if(l=t.isHost,u=t.interval,p="#"+t.channel,h=0,v=t.useParent,y=g(t.remote),l){if(b(t.props,{src:t.remote,name:H+t.channel+"_provider"}),v)t.onLoad=function(){m=e,o(),s.up.callback(!0)};else{var i=0,n=t.delay/50;!function r(){if(++i>n)throw new Error("Unable to reference listenerwindow");try{m=f.contentWindow.frames[H+t.channel+"_consumer"]}catch(e){}m?(o(),s.up.callback(!0)):a(r,50)}()}f=k(t)}else m=e,o(),v?(f=parent,s.up.callback(!0)):(b(t,{props:{src:t.remote+"#"+t.channel+new Date,name:H+t.channel+"_consumer"},onLoad:function(){s.up.callback(!0)}}),f=k(t))},init:function(){c(s.onDOMReady,s)}}},B.stack.ReliableBehavior=function(){var e,t,i=0,a=0,n="";return e={incoming:function(r,o){var s=r.indexOf("_"),l=r.substring(0,s).split(",");r=r.substring(s+1),l[0]==i&&(n="",t&&(t(!0),t=null)),r.length>0&&(e.down.outgoing(l[1]+","+i+"_"+n,o),a!=l[1]&&(a=l[1],e.up.incoming(r,o)))},outgoing:function(r,o,s){n=r,t=s,e.down.outgoing(a+","+ ++i+"_"+r,o)}}},B.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===s.length)return void x(i);if(!l&&0!==s.length&&!o){l=!0;var n=s.shift();i.down.outgoing(n.data,n.origin,function(e){l=!1,n.callback&&a(function(){n.callback(e)},0),t()})}}var i,o,s=[],l=!0,d="",u=0,c=!1,p=!1;return i={init:function(){_(e)&&(e={}),e.maxLength&&(u=e.maxLength,p=!0),e.lazy?c=!0:i.down.init()},callback:function(e){l=!1;var a=i.up;t(),a.callback(e)},incoming:function(t,a){if(p){var r=t.indexOf("_"),o=parseInt(t.substring(0,r),10);d+=t.substring(r+1),0===o&&(e.encode&&(d=n(d)),i.up.incoming(d,a),d="")}else i.up.incoming(t,a)},outgoing:function(a,n,o){e.encode&&(a=r(a));var l,d=[];if(p){for(;0!==a.length;)l=a.substring(0,u),a=a.substring(l.length),d.push(l);for(;l=d.shift();)s.push({data:d.length+"_"+l,origin:n,callback:0===d.length?o:null})}else s.push({data:a,origin:n,callback:o});c?i.down.init():t()},destroy:function(){o=!0,i.down.destroy()}}},B.stack.VerifyBehavior=function(e){function t(){a=Math.random().toString(16).substring(2),i.down.outgoing(a)}var i,a,n;return i={incoming:function(r,o){var s=r.indexOf("_");-1===s?r===a?i.up.callback(!0):n||(n=r,e.initiate||t(),i.down.outgoing(r)):r.substring(0,s)===n&&i.up.incoming(r.substring(s+1),o)},outgoing:function(e,t,n){i.down.outgoing(a+"_"+e,t,n)},callback:function(){e.initiate&&t()}}},B.stack.RpcBehavior=function(e,t){function i(e){e.jsonrpc="2.0",r.down.outgoing(o.stringify(e))}function a(e,t){var a=Array.prototype.slice;return function(){var n,r=arguments.length,o={method:t};r>0&&"function"==typeof arguments[r-1]?(r>1&&"function"==typeof arguments[r-2]?(n={success:arguments[r-2],error:arguments[r-1]},o.params=a.call(arguments,0,r-2)):(n={success:arguments[r-1]},o.params=a.call(arguments,0,r-1)),d[""+ ++s]=n,o.id=s):o.params=a.call(arguments,0),e.namedParams&&1===o.params.length&&(o.params=o.params[0]),i(o)}}function n(e,t,a,n){if(!a)return void(t&&i({id:t,error:{code:-32601,message:"Procedure not found."}}));var r,o;t?(r=function(e){r=O,i({id:t,result:e})},o=function(e,a){o=O;var n={id:t,error:{code:-32099,message:e}};a&&(n.error.data=a),i(n)}):r=o=O,l(n)||(n=[n]);try{var s=a.method.apply(a.scope,n.concat([r,o]));_(s)||r(s)}catch(d){o(d.message)}}var r,o=t.serializer||K(),s=0,d={};return r={incoming:function(e){var a=o.parse(e);if(a.method)t.handle?t.handle(a,i):n(a.method,a.id,t.local[a.method],a.params);else{var r=d[a.id];a.error?r.error&&r.error(a.error):r.success&&r.success(a.result),delete d[a.id]}},init:function(){if(t.remote)for(var i in t.remote)t.remote.hasOwnProperty(i)&&(e[i]=a(t.remote[i],i));r.down.init()},destroy:function(){for(var i in t.remote)t.remote.hasOwnProperty(i)&&e.hasOwnProperty(i)&&delete e[i];r.down.destroy()}}},A.easyXDM=B}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),function(e,t){function i(t,i){var n,r,o,s=t.nodeName.toLowerCase();return"area"===s?(n=t.parentNode,r=n.name,t.href&&r&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap=#"+r+"]")[0],!!o&&a(o)):!1):(/input|select|textarea|button|object/.test(s)?!t.disabled:"a"===s?t.href||i:i)&&a(t)}function a(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,a){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),a&&a.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var a,n,r=e(this[0]);r.length&&r[0]!==document;){if(a=r.css("position"),("absolute"===a||"relative"===a||"fixed"===a)&&(n=parseInt(r.css("zIndex"),10),!isNaN(n)&&0!==n))return n;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,a){return!!e.data(t,a[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var a=e.attr(t,"tabindex"),n=isNaN(a);return(n||a>=0)&&i(t,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,a){function n(t,i,a,n){return e.each(r,function(){i-=parseFloat(e.css(t,"padding"+this))||0,a&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),n&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var r="Width"===a?["Left","Right"]:["Top","Bottom"],o=a.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+a]=function(i){return i===t?s["inner"+a].call(this):this.each(function(){e(this).css(o,n(this,i)+"px")
})},e.fn["outer"+a]=function(t,i){return"number"!=typeof t?s["outer"+a].call(this,t):this.each(function(){e(this).css(o,n(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,a){var n,r=e.ui[t].prototype;for(n in a)r.plugins[n]=r.plugins[n]||[],r.plugins[n].push([i,a[n]])},call:function(e,t,i){var a,n=e.plugins[t];if(n&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(a=0;a<n.length;a++)e.options[n[a][0]]&&n[a][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var a=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[a]>0?!0:(t[a]=1,n=t[a]>0,t[a]=0,n)}})}(jQuery),function(e,t){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){e.datepicker._isDisabledDatepicker(r.inline?t.parent()[0]:r.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))})}function n(t,i){e.extend(t,i);for(var a in i)null==i[a]&&(t[a]=i[a]);return t}e.extend(e.ui,{datepicker:{version:"1.10.4"}});var r,o="datepicker";e.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return n(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var a,n,r;a=t.nodeName.toLowerCase(),n="div"===a||"span"===a,t.id||(this.uuid+=1,t.id="dp"+this.uuid),r=this._newInst(e(t),n),r.settings=e.extend({},i||{}),"input"===a?this._connectDatepicker(t,r):n&&this._inlineDatepicker(t,r)},_newInst:function(t,i){var n=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:n,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var a=e(t);i.append=e([]),i.trigger=e([]),a.hasClass(this.markerClassName)||(this._attachments(a,i),a.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,o,i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var a,n,r,o=this._get(i,"appendText"),s=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[s?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),a=this._get(i,"showOn"),("focus"===a||"both"===a)&&t.focus(this._showDatepicker),("button"===a||"both"===a)&&(n=this._get(i,"buttonText"),r=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:r,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(r?e("<img/>").attr({src:r,alt:n,title:n}):n)),t[s?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,a,n,r=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,a=0,n=0;n<e.length;n++)e[n].length>i&&(i=e[n].length,a=n);return a},r.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),r.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-r.getDay())),e.input.attr("size",this._formatDate(e,r).length)}},_inlineDatepicker:function(t,i){var a=e(t);a.hasClass(this.markerClassName)||(a.addClass(this.markerClassName).append(i.dpDiv),e.data(t,o,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,a,r,s){var l,d,u,c,p,h=this._dialogInst;return h||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),h=this._dialogInst=this._newInst(this._dialogInput,!1),h.settings={},e.data(this._dialogInput[0],o,h)),n(h.settings,r||{}),i=i&&i.constructor===Date?this._formatDate(h,i):i,this._dialogInput.val(i),this._pos=s?s.length?s:[s.pageX,s.pageY]:null,this._pos||(d=document.documentElement.clientWidth,u=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,p=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[d/2-100+c,u/2-150+p]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),h.settings.onSelect=a,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],o,h),this},_destroyDatepicker:function(t){var i,a=e(t),n=e.data(t,o);a.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,o),"input"===i?(n.append.remove(),n.trigger.remove(),a.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&a.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var i,a,n=e(t),r=e.data(t,o);n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,r.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(a=n.children("."+this._inlineClass),a.children().removeClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,a,n=e(t),r=e.data(t,o);n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,r.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(a=n.children("."+this._inlineClass),a.children().addClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,o)}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,a,r){var o,s,l,d,u=this._getInst(i);return 2===arguments.length&&"string"==typeof a?"defaults"===a?e.extend({},e.datepicker._defaults):u?"all"===a?e.extend({},u.settings):this._get(u,a):null:(o=a||{},"string"==typeof a&&(o={},o[a]=r),void(u&&(this._curInst===u&&this._hideDatepicker(),s=this._getDateDatepicker(i,!0),l=this._getMinMaxDate(u,"min"),d=this._getMinMaxDate(u,"max"),n(u.settings,o),null!==l&&o.dateFormat!==t&&o.minDate===t&&(u.settings.minDate=this._formatDate(u,l)),null!==d&&o.dateFormat!==t&&o.maxDate===t&&(u.settings.maxDate=this._formatDate(u,d)),"disabled"in o&&(o.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(e(i),u),this._autoSize(u),this._setDate(u,s),this._updateAlternate(u),this._updateDatepicker(u))))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,a,n,r=e.datepicker._getInst(t.target),o=!0,s=r.dpDiv.is(".ui-datepicker-rtl");if(r._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",r.dpDiv),n[0]&&e.datepicker._selectDay(t.target,r.selectedMonth,r.selectedYear,n[0]),i=e.datepicker._get(r,"onSelect"),i?(a=e.datepicker._formatDate(r),i.apply(r.input?r.input[0]:null,[a,r])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(r,"stepBigMonths"):-e.datepicker._get(r,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(r,"stepBigMonths"):+e.datepicker._get(r,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,s?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(r,"stepBigMonths"):-e.datepicker._get(r,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,s?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(r,"stepBigMonths"):+e.datepicker._get(r,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,a,n=e.datepicker._getInst(t.target);return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),a=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">a||!i||i.indexOf(a)>-1):void 0},_doKeyUp:function(t){var i,a=e.datepicker._getInst(t.target);if(a.input.val()!==a.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(a,"dateFormat"),a.input?a.input.val():null,e.datepicker._getFormatConfig(a)),i&&(e.datepicker._setDateFromField(a),e.datepicker._updateAlternate(a),e.datepicker._updateDatepicker(a))}catch(n){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,a,r,o,s,l,d;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),a=e.datepicker._get(i,"beforeShow"),r=a?a.apply(t,[t,i]):{},r!==!1&&(n(i.settings,r),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|="fixed"===e(this).css("position"),!o}),s={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),s=e.datepicker._checkOffset(i,s,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:s.left+"px",top:s.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),d=e.datepicker._get(i,"duration"),i.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),d):i.dpDiv[l||"show"](l?d:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,r=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i,a=this._getNumberOfMonths(t),n=a[1],o=17;t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",o*n+"em"),t.dpDiv[(1!==a[0]||1!==a[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,a){var n=t.dpDiv.outerWidth(),r=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,s=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(a?0:e(document).scrollLeft()),d=document.documentElement.clientHeight+(a?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=a&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=a&&i.top===t.input.offset().top+s?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+r>d&&d>r?Math.abs(r+s):0),i},_findPos:function(t){for(var i,a=this._getInst(t),n=this._get(a,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,a,n,r,s=this._curInst;!s||t&&s!==e.data(t,o)||this._datepickerShowing&&(i=this._get(s,"showAnim"),a=this._get(s,"duration"),n=function(){e.datepicker._tidyDialog(s)},e.effects&&(e.effects.effect[i]||e.effects[i])?s.dpDiv.hide(i,e.datepicker._get(s,"showOptions"),a,n):s.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?a:null,n),i||n(),this._datepickerShowing=!1,r=this._get(s,"onClose"),r&&r.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),a=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==a)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,a){var n=e(t),r=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(r,i+("M"===a?this._get(r,"showCurrentAtPos"):0),a),this._updateDatepicker(r))},_gotoToday:function(t){var i,a=e(t),n=this._getInst(a[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(a)},_selectMonthYear:function(t,i,a){var n=e(t),r=this._getInst(n[0]);r["selected"+("M"===a?"Month":"Year")]=r["draw"+("M"===a?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(r),this._adjustDate(n)},_selectDay:function(t,i,a,n){var r,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(r=this._getInst(o[0]),r.selectedDay=r.currentDay=e("a",n).html(),r.selectedMonth=r.currentMonth=i,r.selectedYear=r.currentYear=a,this._selectDate(t,this._formatDate(r,r.currentDay,r.currentMonth,r.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var a,n=e(t),r=this._getInst(n[0]);i=null!=i?i:this._formatDate(r),r.input&&r.input.val(i),this._updateAlternate(r),a=this._get(r,"onSelect"),a?a.apply(r.input?r.input[0]:null,[i,r]):r.input&&r.input.trigger("change"),r.inline?this._updateDatepicker(r):(this._hideDatepicker(),this._lastInput=r.input[0],"object"!=typeof r.input[0]&&r.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,a,n,r=this._get(t,"altField");r&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),a=this._getDate(t),n=this.formatDate(i,a,this._getFormatConfig(t)),e(r).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,a){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?i.toString():i+"",""===i)return null;var n,r,o,s,l=0,d=(a?a.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof d?d:(new Date).getFullYear()%100+parseInt(d,10),c=(a?a.dayNamesShort:null)||this._defaults.dayNamesShort,p=(a?a.dayNames:null)||this._defaults.dayNames,h=(a?a.monthNamesShort:null)||this._defaults.monthNamesShort,m=(a?a.monthNames:null)||this._defaults.monthNames,f=-1,g=-1,v=-1,y=-1,_=!1,b=function(e){var i=n+1<t.length&&t.charAt(n+1)===e;return i&&n++,i},w=function(e){var t=b(e),a="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n=new RegExp("^\\d{1,"+a+"}"),r=i.substring(l).match(n);if(!r)throw"Missing number at position "+l;return l+=r[0].length,parseInt(r[0],10)},k=function(t,a,n){var r=-1,o=e.map(b(t)?n:a,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(o,function(e,t){var a=t[1];return i.substr(l,a.length).toLowerCase()===a.toLowerCase()?(r=t[0],l+=a.length,!1):void 0}),-1!==r)return r+1;throw"Unknown name at position "+l},D=function(){if(i.charAt(l)!==t.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;n<t.length;n++)if(_)"'"!==t.charAt(n)||b("'")?D():_=!1;else switch(t.charAt(n)){case"d":v=w("d");break;case"D":k("D",c,p);break;case"o":y=w("o");break;case"m":g=w("m");break;case"M":g=k("M",h,m);break;case"y":f=w("y");break;case"@":s=new Date(w("@")),f=s.getFullYear(),g=s.getMonth()+1,v=s.getDate();break;case"!":s=new Date((w("!")-this._ticksTo1970)/1e4),f=s.getFullYear(),g=s.getMonth()+1,v=s.getDate();break;case"'":b("'")?D():_=!0;break;default:D()}if(l<i.length&&(o=i.substr(l),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===f?f=(new Date).getFullYear():100>f&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=f?0:-100)),y>-1)for(g=1,v=y;;){if(r=this._getDaysInMonth(f,g-1),r>=v)break;g++,v-=r}if(s=this._daylightSavingAdjust(new Date(f,g-1,v)),s.getFullYear()!==f||s.getMonth()+1!==g||s.getDate()!==v)throw"Invalid date";return s},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var a,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,r=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,s=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=a+1<e.length&&e.charAt(a+1)===t;return i&&a++,i},d=function(e,t,i){var a=""+t;if(l(e))for(;a.length<i;)a="0"+a;return a},u=function(e,t,i,a){return l(e)?a[t]:i[t]},c="",p=!1;if(t)for(a=0;a<e.length;a++)if(p)"'"!==e.charAt(a)||l("'")?c+=e.charAt(a):p=!1;else switch(e.charAt(a)){case"d":c+=d("d",t.getDate(),2);break;case"D":c+=u("D",t.getDay(),n,r);break;case"o":c+=d("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=d("m",t.getMonth()+1,2);break;case"M":c+=u("M",t.getMonth(),o,s);break;case"y":c+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":c+=t.getTime();break;case"!":c+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?c+="'":p=!0;break;default:c+=e.charAt(a)}return c},_possibleChars:function(e){var t,i="",a=!1,n=function(i){var a=t+1<e.length&&e.charAt(t+1)===i;return a&&t++,a};for(t=0;t<e.length;t++)if(a)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):a=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":a=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,i){return e.settings[i]!==t?e.settings[i]:this._defaults[i]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),a=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),r=n,o=this._getFormatConfig(e);try{r=this.parseDate(i,a,o)||n}catch(s){a=t?"":a}e.selectedDay=r.getDate(),e.drawMonth=e.selectedMonth=r.getMonth(),e.drawYear=e.selectedYear=r.getFullYear(),e.currentDay=a?r.getDate():0,e.currentMonth=a?r.getMonth():0,e.currentYear=a?r.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,a){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},r=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(a){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,r=n.getFullYear(),o=n.getMonth(),s=n.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,d=l.exec(i);d;){switch(d[2]||"d"){case"d":case"D":s+=parseInt(d[1],10);break;case"w":case"W":s+=7*parseInt(d[1],10);break;case"m":case"M":o+=parseInt(d[1],10),s=Math.min(s,e.datepicker._getDaysInMonth(r,o));break;case"y":case"Y":r+=parseInt(d[1],10),s=Math.min(s,e.datepicker._getDaysInMonth(r,o))}d=l.exec(i)}return new Date(r,o,s)},o=null==i||""===i?a:"string"==typeof i?r(i):"number"==typeof i?isNaN(i)?a:n(i):new Date(i.getTime());return o=o&&"Invalid Date"===o.toString()?a:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var a=!t,n=e.selectedMonth,r=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&r===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(a?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),a="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(a,-i,"M")},next:function(){e.datepicker._adjustDate(a,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(a)},selectDay:function(){return e.datepicker._selectDay(a,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(a,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(a,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,a,n,r,o,s,l,d,u,c,p,h,m,f,g,v,y,_,b,w,k,D,M,S,x,T,C,I,E,$,A,P,O,F,N,L,R,B,j=new Date,H=this._daylightSavingAdjust(new Date(j.getFullYear(),j.getMonth(),j.getDate())),U=this._get(e,"isRTL"),W=this._get(e,"showButtonPanel"),V=this._get(e,"hideIfNoPrevNext"),Y=this._get(e,"navigationAsDateFormat"),q=this._getNumberOfMonths(e),z=this._get(e,"showCurrentAtPos"),K=this._get(e,"stepMonths"),J=1!==q[0]||1!==q[1],X=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),G=this._getMinMaxDate(e,"min"),Q=this._getMinMaxDate(e,"max"),Z=e.drawMonth-z,et=e.drawYear;if(0>Z&&(Z+=12,et--),Q)for(t=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-q[0]*q[1]+1,Q.getDate())),t=G&&G>t?G:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=Y?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-K,1)),this._getFormatConfig(e)):i,a=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>":V?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=Y?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+K,1)),this._getFormatConfig(e)):n,r=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+n+"</span></a>":V?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+n+"</span></a>",o=this._get(e,"currentText"),s=this._get(e,"gotoCurrent")&&e.currentDay?X:H,o=Y?this.formatDate(o,s,this._getFormatConfig(e)):o,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",d=W?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(U?l:"")+(this._isInRange(e,s)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(U?"":l)+"</div>":"",u=parseInt(this._get(e,"firstDay"),10),u=isNaN(u)?0:u,c=this._get(e,"showWeek"),p=this._get(e,"dayNames"),h=this._get(e,"dayNamesMin"),m=this._get(e,"monthNames"),f=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),_=this._getDefaultDate(e),b="",k=0;k<q[0];k++){for(D="",this.maxRows=4,M=0;M<q[1];M++){if(S=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),x=" ui-corner-all",T="",J){if(T+="<div class='ui-datepicker-group",q[1]>1)switch(M){case 0:T+=" ui-datepicker-group-first",x=" ui-corner-"+(U?"right":"left");break;case q[1]-1:T+=" ui-datepicker-group-last",x=" ui-corner-"+(U?"left":"right");break;default:T+=" ui-datepicker-group-middle",x=""}T+="'>"}for(T+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+x+"'>"+(/all|left/.test(x)&&0===k?U?r:a:"")+(/all|right/.test(x)&&0===k?U?a:r:"")+this._generateMonthYearHeader(e,Z,et,G,Q,k>0||M>0,m,f)+"</div><table class='ui-datepicker-calendar'><thead><tr>",C=c?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",w=0;7>w;w++)I=(w+u)%7,C+="<th"+((w+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+p[I]+"'>"+h[I]+"</span></th>";for(T+=C+"</tr></thead><tbody>",E=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,E)),$=(this._getFirstDayOfMonth(et,Z)-u+7)%7,A=Math.ceil(($+E)/7),P=J&&this.maxRows>A?this.maxRows:A,this.maxRows=P,O=this._daylightSavingAdjust(new Date(et,Z,1-$)),F=0;P>F;F++){for(T+="<tr>",N=c?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(O)+"</td>":"",w=0;7>w;w++)L=g?g.apply(e.input?e.input[0]:null,[O]):[!0,""],R=O.getMonth()!==Z,B=R&&!y||!L[0]||G&&G>O||Q&&O>Q,N+="<td class='"+((w+u+6)%7>=5?" ui-datepicker-week-end":"")+(R?" ui-datepicker-other-month":"")+(O.getTime()===S.getTime()&&Z===e.selectedMonth&&e._keyEvent||_.getTime()===O.getTime()&&_.getTime()===S.getTime()?" "+this._dayOverClass:"")+(B?" "+this._unselectableClass+" ui-state-disabled":"")+(R&&!v?"":" "+L[1]+(O.getTime()===X.getTime()?" "+this._currentClass:"")+(O.getTime()===H.getTime()?" ui-datepicker-today":""))+"'"+(R&&!v||!L[2]?"":" title='"+L[2].replace(/'/g,"&#39;")+"'")+(B?"":" data-handler='selectDay' data-event='click' data-month='"+O.getMonth()+"' data-year='"+O.getFullYear()+"'")+">"+(R&&!v?"&#xa0;":B?"<span class='ui-state-default'>"+O.getDate()+"</span>":"<a class='ui-state-default"+(O.getTime()===H.getTime()?" ui-state-highlight":"")+(O.getTime()===X.getTime()?" ui-state-active":"")+(R?" ui-priority-secondary":"")+"' href='#'>"+O.getDate()+"</a>")+"</td>",O.setDate(O.getDate()+1),O=this._daylightSavingAdjust(O);T+=N+"</tr>"}Z++,Z>11&&(Z=0,et++),T+="</tbody></table>"+(J?"</div>"+(q[0]>0&&M===q[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),D+=T}b+=D}return b+=d,e._keyEvent=!1,b},_generateMonthYearHeader:function(e,t,i,a,n,r,o,s){var l,d,u,c,p,h,m,f,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),_="<div class='ui-datepicker-title'>",b="";if(r||!g)b+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(l=a&&a.getFullYear()===i,d=n&&n.getFullYear()===i,b+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",u=0;12>u;u++)(!l||u>=a.getMonth())&&(!d||u<=n.getMonth())&&(b+="<option value='"+u+"'"+(u===t?" selected='selected'":"")+">"+s[u]+"</option>");
b+="</select>"}if(y||(_+=b+(!r&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",r||!v)_+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(c=this._get(e,"yearRange").split(":"),p=(new Date).getFullYear(),h=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?p+parseInt(e,10):parseInt(e,10);return isNaN(t)?p:t},m=h(c[0]),f=Math.max(m,h(c[1]||"")),m=a?Math.max(m,a.getFullYear()):m,f=n?Math.min(f,n.getFullYear()):f,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";f>=m;m++)e.yearshtml+="<option value='"+m+"'"+(m===i?" selected='selected'":"")+">"+m+"</option>";e.yearshtml+="</select>",_+=e.yearshtml,e.yearshtml=null}return _+=this._get(e,"yearSuffix"),y&&(_+=(!r&&g&&v?"":"&#xa0;")+b),_+="</div>"},_adjustInstDate:function(e,t,i){var a=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),r=Math.min(e.selectedDay,this._getDaysInMonth(a,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(a,n,r)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return a&&n>a?a:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,a){var n=this._getNumberOfMonths(e),r=this._daylightSavingAdjust(new Date(i,a+(0>t?t:n[0]*n[1]),1));return 0>t&&r.setDate(this._getDaysInMonth(r.getFullYear(),r.getMonth())),this._isInRange(e,r)},_isInRange:function(e,t){var i,a,n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),o=null,s=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),a=(new Date).getFullYear(),o=parseInt(i[0],10),s=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=a),i[1].match(/[+\-].*/)&&(s+=a)),(!n||t.getTime()>=n.getTime())&&(!r||t.getTime()<=r.getTime())&&(!o||t.getFullYear()>=o)&&(!s||t.getFullYear()<=s)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,a){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(a,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new i,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.4"}(jQuery),function(e,t){var i=0,a=Array.prototype.slice,n=e.cleanData;e.cleanData=function(t){for(var i,a=0;null!=(i=t[a]);a++)try{e(i).triggerHandler("remove")}catch(r){}n(t)},e.widget=function(t,i,a){var n,r,o,s,l={},d=t.split(".")[0];t=t.split(".")[1],n=d+"-"+t,a||(a=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[d]=e[d]||{},r=e[d][t],o=e[d][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new o(e,t)},e.extend(o,r,{version:a.version,_proto:e.extend({},a),_childConstructors:[]}),s=new i,s.options=e.widget.extend({},s.options),e.each(a,function(t,a){return e.isFunction(a)?void(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=n,t=a.apply(this,arguments),this._super=i,this._superApply=r,t}}()):void(l[t]=a)}),o.prototype=e.widget.extend(s,{widgetEventPrefix:r?s.widgetEventPrefix||t:t},l,{constructor:o,namespace:d,widgetName:t,widgetFullName:n}),r?(e.each(r._childConstructors,function(t,i){var a=i.prototype;e.widget(a.namespace+"."+a.widgetName,o,i._proto)}),delete r._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(i){for(var n,r,o=a.call(arguments,1),s=0,l=o.length;l>s;s++)for(n in o[s])r=o[s][n],o[s].hasOwnProperty(n)&&r!==t&&(i[n]=e.isPlainObject(r)?e.isPlainObject(i[n])?e.widget.extend({},i[n],r):e.widget.extend({},r):r);return i},e.widget.bridge=function(i,n){var r=n.prototype.widgetFullName||i;e.fn[i]=function(o){var s="string"==typeof o,l=a.call(arguments,1),d=this;return o=!s&&l.length?e.widget.extend.apply(null,[o].concat(l)):o,this.each(s?function(){var a,n=e.data(this,r);return n?e.isFunction(n[o])&&"_"!==o.charAt(0)?(a=n[o].apply(n,l),a!==n&&a!==t?(d=a&&a.jquery?d.pushStack(a.get()):a,!1):void 0):e.error("no such method '"+o+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; attempted to call method '"+o+"'")}:function(){var t=e.data(this,r);t?t.option(o||{})._init():e.data(this,r,new n(o,this))}),d}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,a){a=e(a||this.defaultElement||this)[0],this.element=e(a),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),a!==this&&(e.data(a,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===a&&this.destroy()}}),this.document=e(a.style?a.ownerDocument:a.document||a),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,a){var n,r,o,s=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(s={},n=i.split("."),i=n.shift(),n.length){for(r=s[i]=e.widget.extend({},this.options[i]),o=0;o<n.length-1;o++)r[n[o]]=r[n[o]]||{},r=r[n[o]];if(i=n.pop(),1===arguments.length)return r[i]===t?null:r[i];r[i]=a}else{if(1===arguments.length)return this.options[i]===t?null:this.options[i];s[i]=a}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,a){var n,r=this;"boolean"!=typeof t&&(a=i,i=t,t=!1),a?(i=n=e(i),this.bindings=this.bindings.add(i)):(a=i,i=this.element,n=this.widget()),e.each(a,function(a,o){function s(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):void 0}"string"!=typeof o&&(s.guid=o.guid=o.guid||s.guid||e.guid++);var l=a.match(/^(\w+)\s*(.*)$/),d=l[1]+r.eventNamespace,u=l[2];u?n.delegate(u,d,s):i.bind(d,s)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?a[e]:e).apply(a,arguments)}var a=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,a){var n,r,o=this.options[t];if(a=a||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(n in r)n in i||(i[n]=r[n]);return this.element.trigger(i,a),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(a))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(a,n,r){"string"==typeof n&&(n={effect:n});var o,s=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=r,n.delay&&a.delay(n.delay),o&&e.effects&&e.effects.effect[s]?a[t](n):s!==t&&a[s]?a[s](n.duration,n.easing,r):a.queue(function(i){e(this)[t](),r&&r.call(a[0]),i()})}})}(jQuery),function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):"object"==typeof exports?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){"use strict";function t(t){var i="dragover"===t;return function(a){a.dataTransfer=a.originalEvent&&a.originalEvent.dataTransfer;var n=a.dataTransfer;n&&-1!==e.inArray("Files",n.types)&&this._trigger(t,e.Event(t,{delegatedEvent:a}))!==!1&&(a.preventDefault(),i&&(n.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&e.each(i,function(e,i){t=t.replace("{"+e+"}",i)}),t},formData:function(e){return e.serializeArray()},add:function(t,i){return t.isDefaultPrevented()?!1:void((i.autoUpload||i.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var a=e-this.timestamp;return(!this.bitrate||!i||a>i)&&(this.bitrate=(t-this.loaded)*(1e3/a)*8,this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"===e.type(t.formData)?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,i):t._progress=i},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,i){if(t.lengthComputable){var a,n=Date.now?Date.now():(new Date).getTime();if(i._time&&i.progressInterval&&n-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=n,a=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0),this._progress.loaded+=a-i._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,i.bitrateInterval),i._progress.loaded=i.loaded=a,i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(n,a,i.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),i),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var i=this,a=t.xhr?t.xhr():e.ajaxSettings.xhr();a.upload&&(e(a.upload).bind("progress",function(e){var a=e.originalEvent;e.lengthComputable=a.lengthComputable,e.loaded=a.loaded,e.total=a.total,i._onProgress(e,t)}),t.xhr=function(){return a})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var i,a=this,n=t.files[0],r=t.multipart||!e.support.xhrFileUpload,o="array"===e.type(t.paramName)?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),r&&!t.blob&&this._isInstanceOf("File",n)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(n.name)+'"'),r?e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:o,value:t.blob}):e.each(t.files,function(a,n){i.push({name:"array"===e.type(t.paramName)&&t.paramName[a]||o,value:n})})):(a._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(o,t.blob,n.name):e.each(t.files,function(n,r){(a._isInstanceOf("File",r)||a._isInstanceOf("Blob",r))&&i.append("array"===e.type(t.paramName)&&t.paramName[n]||o,r,r.uploadName||r.name)})),t.data=i):(t.contentType=n.type||"application/octet-stream",t.data=t.blob||n),t.blob=null},_initIframeSettings:function(t){var i=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var i=e(t.fileInput),a=t.paramName;return a?e.isArray(a)||(a=[a]):(a=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",n=(t.prop("files")||[1]).length;n;)a.push(i),n-=1}),a.length||(a=[i.prop("name")||"files[]"])),a},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,a){var n=e.Deferred(),r=n.promise();return i=i||this.options.context||r,t===!0?n.resolveWith(i,a):t===!1&&n.rejectWith(i,a),r.abort=n.promise,this._enhancePromise(r)},_addConvenienceMethods:function(t,i){var a=this,n=function(t){return e.Deferred().resolveWith(a,t).promise()};i.process=function(t,r){return(t||r)&&(i._processQueue=this._processQueue=(this._processQueue||n([this])).pipe(function(){return i.errorThrown?e.Deferred().rejectWith(a,[i]).promise():n(arguments)}).pipe(t,r)),this._processQueue||n([this])},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=a._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&a._onSend(t,this)),this.jqXHR||a._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",a._trigger("fail",null,this),a._getXHRPromise(!1))},i.state=function(){return this.jqXHR?a._getDeferredState(this.jqXHR):this._processQueue?a._getDeferredState(this._processQueue):void 0},i.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===a._getDeferredState(this._processQueue)},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),a=i&&i.length>1&&parseInt(i[1],10);return a&&a+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var a,n,r=this,o=t.files[0],s=o.size,l=t.uploadedBytes,d=t.maxChunkSize||s,u=this._blobSlice,c=e.Deferred(),p=c.promise();return this._isXHRUpload(t)&&u&&(l||s>d)&&!t.data?i?!0:l>=s?(o.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",o.error])):(n=function(){var i=e.extend({},t),p=i._progress.loaded;i.blob=u.call(o,l,l+d,o.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+s,r._initXHRData(i),r._initProgressListener(i),a=(r._trigger("chunksend",null,i)!==!1&&e.ajax(i)||r._getXHRPromise(!1,i.context)).done(function(a,o,d){l=r._getUploadedBytes(d)||l+i.chunkSize,p+i.chunkSize-i._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=a,i.textStatus=o,i.jqXHR=d,r._trigger("chunkdone",null,i),r._trigger("chunkalways",null,i),s>l?n():c.resolveWith(i.context,[a,o,d])}).fail(function(e,t,a){i.jqXHR=e,i.textStatus=t,i.errorThrown=a,r._trigger("chunkfail",null,i),r._trigger("chunkalways",null,i),c.rejectWith(i.context,[e,t,a])})},this._enhancePromise(p),p.abort=function(){return a.abort()},n(),p):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,a,n){var r=n._progress.total,o=n._response;n._progress.loaded<r&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:r,total:r}),n),o.result=n.result=t,o.textStatus=n.textStatus=i,o.jqXHR=n.jqXHR=a,this._trigger("done",null,n)},_onFail:function(e,t,i,a){var n=a._response;a.recalculateProgress&&(this._progress.loaded-=a._progress.loaded,this._progress.total-=a._progress.total),n.jqXHR=a.jqXHR=e,n.textStatus=a.textStatus=t,n.errorThrown=a.errorThrown=i,this._trigger("fail",null,a)},_onAlways:function(e,t,i,a){this._trigger("always",null,a)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var a,n,r,o,s=this,l=s._getAJAXSettings(i),d=function(){return s._sending+=1,l._bitrateTimer=new s._BitrateTimer,a=a||((n||s._trigger("send",e.Event("send",{delegatedEvent:t}),l)===!1)&&s._getXHRPromise(!1,l.context,n)||s._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){s._onDone(e,t,i,l)}).fail(function(e,t,i){s._onFail(e,t,i,l)}).always(function(e,t,i){if(s._onAlways(e,t,i,l),s._sending-=1,s._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>s._sending)for(var a=s._slots.shift();a;){if("pending"===s._getDeferredState(a)){a.resolve();break}a=s._slots.shift()}0===s._active&&s._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(r=e.Deferred(),this._slots.push(r),o=r.pipe(d)):(this._sequence=this._sequence.pipe(d,d),o=this._sequence),o.abort=function(){return n=[void 0,"abort","abort"],a?a.abort():(r&&r.rejectWith(l.context,n),d())},this._enhancePromise(o)):d()},_onAdd:function(t,i){var a,n,r,o,s=this,l=!0,d=e.extend({},this.options,i),u=i.files,c=u.length,p=d.limitMultiFileUploads,h=d.limitMultiFileUploadSize,m=d.limitMultiFileUploadSizeOverhead,f=0,g=this._getParamName(d),v=0;if(!h||c&&void 0!==u[0].size||(h=void 0),(d.singleFileUploads||p||h)&&this._isXHRUpload(d))if(d.singleFileUploads||h||!p)if(!d.singleFileUploads&&h)for(r=[],a=[],o=0;c>o;o+=1)f+=u[o].size+m,(o+1===c||f+u[o+1].size+m>h||p&&o+1-v>=p)&&(r.push(u.slice(v,o+1)),n=g.slice(v,o+1),n.length||(n=g),a.push(n),v=o+1,f=0);else a=g;else for(r=[],a=[],o=0;c>o;o+=p)r.push(u.slice(o,o+p)),n=g.slice(o,o+p),n.length||(n=g),a.push(n);else r=[u],a=[g];return i.originalFiles=u,e.each(r||u,function(n,o){var d=e.extend({},i);return d.files=r?o:[o],d.paramName=a[n],s._initResponseObject(d),s._initProgressObject(d),s._addConvenienceMethods(t,d),l=s._trigger("add",e.Event("add",{delegatedEvent:t}),d)}),l},_replaceFileInput:function(t){var i=t.fileInput,a=i.clone(!0);t.fileInputClone=a,e("<form></form>").append(a)[0].reset(),i.after(a).detach(),e.cleanData(i.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===i[0]?a[0]:t}),i[0]===this.element[0]&&(this.element=a)},_handleFileTreeEntry:function(t,i){var a,n=this,r=e.Deferred(),o=function(e){e&&!e.entry&&(e.entry=t),r.resolve([e])},s=function(e){n._handleFileTreeEntries(e,i+t.name+"/").done(function(e){r.resolve(e)}).fail(o)},l=function(){a.readEntries(function(e){e.length?(d=d.concat(e),l()):s(d)},o)},d=[];return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(e){e.relativePath=i,r.resolve(e)},o):t.isDirectory?(a=t.createReader(),l()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var a=this;return e.when.apply(e,e.map(t,function(e){return a._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,a,n=t.prop("webkitEntries")||t.prop("entries");if(n&&n.length)return this._handleFileTreeEntries(n);if(i=e.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&e.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(a=t.prop("value"),!a)return e.Deferred().resolve([]).promise();i=[{name:a.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,a={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(a.fileInput).always(function(n){a.files=n,i.options.replaceFileInput&&i._replaceFileInput(a),i._trigger("change",e.Event("change",{delegatedEvent:t}),a)!==!1&&i._onAdd(t,a)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,a={files:[]};i&&i.length&&(e.each(i,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&a.files.push(i)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),a)!==!1&&this._onAdd(t,a))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=this,a=t.dataTransfer,n={};a&&a.files&&a.files.length&&(t.preventDefault(),this._getDroppedFiles(a).always(function(a){n.files=a,i._trigger("drop",e.Event("drop",{delegatedEvent:t}),n)!==!1&&i._onAdd(t,n)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,i){var a=-1!==e.inArray(t,this._specialOptions);a&&this._destroyEventHandlers(),this._super(t,i),a&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return"url"!==t&&"string"===e.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,a=this.element.data();e.each(this.element[0].attributes,function(e,n){var r,o=n.name.toLowerCase();/^data-/.test(o)&&(o=o.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),r=a[o],t._isRegExpOption(o,r)&&(r=t._getRegExp(r)),i[o]=r)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,a,n=this,r=e.Deferred(),o=r.promise();return o.abort=function(){return a=!0,i?i.abort():(r.reject(null,"abort","abort"),o)},this._getFileInputFiles(t.fileInput).always(function(e){if(!a){if(!e.length)return void r.reject();t.files=e,i=n._onSend(null,t),i.then(function(e,t,i){r.resolve(e,t,i)},function(e,t,i){r.reject(e,t,i)})}}),this._enhancePromise(o)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),formElementsSettingsModule.prototype={_showHideFileSizeNotifications:function(e,t){var i;if(i="wix"==HOST?t.parent().parent().siblings(".fileSizeNotificationEl"):t.parent().siblings(".fileSizeNotificationEl"),"file"!==e)return i.hide();var a=this.model.meta.premium_status;i.each(function(){var e=$(this),t=e.attr("data-premium-status");if(t===a){e.css("display","block");var i="enterprise"===a;i&&(e.find("a").removeClass("triggerPremium"),e.find("a").attr("href","mailto:support@powr.io").attr("target","_blank"))}else e.hide()})},initialize:function(){var e=this;this.$el.on("click",".elementItem .formadd",function(t){if($(this).hasClass("premium"))return t.stopPropagation(),!1;var i=$(this).data("type");if("step"!==i||e.model.attributes.multistepForm){var a=$("#formElementSettingsTemplate").html(),n=_.template(a,{type:i,idx:e.model.get("data").length});e.$el.find(".formElementsWrapper").addPrototype(function(t){t.find(".form-details").html(n),t.find(".toggleSpace").click(),e.backboneView.updateInputFields(),e.backboneView.validateExternalFields(),e.backboneView.initializeSliders(),e.renderMediaBars(),t.find('[name="characterLimit"]').each(function(){0===$(this).val().toString().length&&$(this).val(250)}),t.find('[name="paragraphHeight"]').each(function(){0===$(this).val().toString().length&&$(this).val("50px")}),t.find(".optionsOpenTrigger").click(),e.backboneView.update(),e.backboneView.updatePremiumContent(),e.$el.find("#elementsModal").modal("hide")})}}),this.$el.on("click",".advancedTrigger",function(){var e=$(this);e.hasClass("showText")?(e.removeClass("showText"),e.addClass("hideText"),e.text(e.attr("data-lng-hide-advanced"))):(e.addClass("showText"),e.removeClass("hideText"),e.text(e.attr("data-lng-show-advanced"))),e.next(".advanced").slideToggle()}),this.$el.on("keyup",".formElementsWrapper [name=label]",function(){"undefined"!=typeof BAD_WORD_VALIDATION_TIMER&&clearTimeout(BAD_WORD_VALIDATION_TIMER);var t=$(this);BAD_WORD_VALIDATION_TIMER=setTimeout(function(){var i=[],a=["postcard","pittsford"],n=["credit card","credit card number","ccn"],r=t.parents(".prototype-element").find(".validation");r.hide().html("");for(var o=t.val(),s=function(i,n){var s=o.toLowerCase().match(i);if(s){var l=s.length,d=1===l,u=$.inArray(s[0],a)>-1;if(d&&u)return;if(o.toLowerCase().search(i)>-1){r.html(n(i)).fadeIn();var c=new RegExp(i,"ig");t.val(o.replace(c,"")),e.backboneView.update()}}},l=0;l<i.length;l++)s(i[l],function(){return'<i class="fa fa-warning"></i> This form cannot collect password information. <a target="_blank" href="mailto:support@powr.io">Need help?</a>'});for(var l=0;l<n.length;l++)s(n[l],function(e){return'<i class="fa fa-warning"></i> This form cannot collect '+e+' information here. Instead, try enabling payments. <a target="_blank" href="mailto:support@powr.io">Need help?</a>'})},500)});var t=function(e,t){var i=t.split(/,|\n|\r/g).map(function(e){return e.trim()}).filter(function(e){return e.length>0});if(i.length<2)return!1;var a=e.closest(".formElements").find(".optionsWrapper");return 0==$(document.activeElement).val().trim().length&&$(document.activeElement).closest(".options").objectToForm({name:i.shift(),priceChange:""}),_.each(i,function(e){var t=a.addPrototype(null,{speed:"instant"});t.objectToForm({name:e,priceChange:""})}),!0};this.$el.on("paste",".optionInput input",function(e){var e=e.originalEvent||e,i=$(this);if(e&&e.clipboardData&&e.clipboardData.getData){var a=e.clipboardData.getData("text/plain");if(a&&t(i,a))return e.stopPropagation(),e.preventDefault(),!1}setTimeout(function(){t(i,i.val())},50)})},renderFormElements:function(e){var t=this.model.get("locals").expandedPanels||[],i=this.model.get("locals").expandedAdvancedSections||[];e=e||0,this.$el.find(".formElements.prototype-element:not(.prototype)").remove(),this.$el.find(".discountWrapper .discount:not(.prototype)").remove();var a=this,n=jQuery.extend(!0,{},this.model.get(this.formDataKey)),r=$("#formElementSettingsTemplate").html();for(var o in n){var s=this.$el.find(".formElementsWrapper.prototype-wrapper").addPrototype(null,{speed:"instant"}),l=n[o],d=[];"undefined"!=typeof l.options&&null!=l.options&&(l.options=$.map(l.options,function(e,t){return d[t]=d[t]||{},d[t].option=e,[e]}),l.options=l.options.join(", ")),"undefined"!=typeof l.prices&&l.prices&&(l.prices=$.map(l.prices,function(e,t){return d[t]=d[t]||{},d[t].price=e,[e]}),l.prices=l.prices.join(", ")),"undefined"!=typeof l.altTags&&l.altTag&&(l.altTags=$.map(l.altTags,function(e,t){return d[t]=d[t]||{},d[t].altTag=e,[e]
})),d.altTags=l.altTags;var u=_.template(r,{type:l.type,idx:o});s.find(".form-details").html(u),s.objectToForm(l),t.indexOf(o)>=0&&s.find(".panel-collapse").show(),i.indexOf(o)>=0&&(s.find(".showText").removeClass("showText").addClass("hideText"),s.find(".advanced").show()),a.model.get("multistepForm")&&("step"===l.type?(s.find(".toggleSpace").removeClass("toggleSpace"),s.find(".truncated").removeClass(".truncated")):s.find(".mediaBar").css("padding-left","50px")),d.length>0&&(debug()(d),_.each(d,function(e){var t=$(s).find(".optionsWrapper").addPrototype(null,{speed:"instant"});t.objectToForm({name:e.option||"",priceChange:e.price||"",altTag:e.altTag||""})}))}for(var o in a.model.get("discounts")){var c=a.model.get("discounts")[o],p=this.$el.find(".discountWrapper").addPrototype(null,{speed:"instant"});p.objectToForm(c)}if(a.$el.find('[name="characterLimit"]').each(function(){0==$(this).val().toString().length&&$(this).val(250)}),a.$el.find('[name="paragraphHeight"]').each(function(){0==$(this).val().toString().length&&$(this).val("50px")}),"free"!==a.model.meta.premium_status&&a.$el.find(".conditionalLogic").find(".premium").removeClass("premium"),"wix"===HOST)var h=a.$el.find(".wixSection.connectTabSelector");else var h=a.$el.find(".connect");h.scrollTop(e),this.backboneView.initializeSliders(),this.backboneView.initializeImagePickers(),this.backboneView.initializeCheckboxes(),this.backboneView.initializeWixCheckboxes(),this.renderMediaBars(),this.updateConditionalLogic()},renderMediaBars:function(){var e=1;for(var t in this.model.get(this.formDataKey)){var i=this.model.get(this.formDataKey)[t],a=$(this.$el.find(".formElements.prototype-element:not(.prototype)")[t]),n=i.label||"";if(0==n.length)switch(i.type){case"text":n="Single Line Text";break;case"textarea":n="Paragraph Text";break;case"select":n="Dropdown";break;case"radio":n="Multiple Choice";break;case"checkbox":n="Checkbox";break;case"multipleCheckbox":n="Multiple Checkboxes";break;case"radioimage":n="Multiple Images";break;case"date":n="Date and Time";break;case"email":n="Email";break;case"file":n="File Upload";break;case"image":n="Image";break;case"label":n="Label";break;case"linebreak":n="Line Break";break;case"number":n="Number";break;case"phone":n="Phone";break;case"space":n="Spacer";break;case"url":n="URL";break;case"address":n="Address";break;case"step":n="Step "+e.toString(),1===e&&a.find(".delete, .sort, .duplicate").remove(),e++}a.find(".mediaBar .title").html(truncate(n,"35"));var r=a.find(".mediaBar .on-hover-png"),o="//s3-us-west-1.amazonaws.com/powr/formbuilder-gifs/"+i.type+".png";r.css({backgroundImage:"url("+o+")"}),r.html("");var s=a.find(".mediaBar .on-hover-gif"),l="//s3-us-west-1.amazonaws.com/powr/formbuilder-gifs/"+i.type+".gif";s.css({backgroundImage:"url("+l+")"}),s.html("")}},readFormElements:function(){var e=this,t=[];this.$el.find(".formElements.prototype-element:not(.prototype):not(.options)").each(function(){var i=$(this).formToObject(),a=[];$(this).find(".optionsWrapper").find(".prototype-element:not(.prototype)").each(function(){a.push($(this).formToObject())}),i.options=a.map(function(e){return e.name}),i.prices=a.map(function(e){return e.priceChange}),i.altTags=a.map(function(e){return e.altTag}),delete i[""],"free"==e.model.meta.premium_status&&(i.paragraphHeight="50px"),t.push(i)});var i=[];this.$el.find(".prototype-element.discount:not(.prototype)").each(function(){var e=$(this).formToObject();e.discountType||(e.discountType="flat"),i.push(e)}),this.model.setLocals({discountCode:""}),this.model.attributes[e.formDataKey]=t,this.model.attributes.discounts=i},updateFormElementConditionals:function(){this.model.get(this.paymentRequiredKey)?(this.$el.find("#captchasAccordion").slideUp(),this.$el.find(".whenPayments").slideDown(),this.$el.find("#discountCodeAccordion").show()):(this.$el.find("#captchasAccordion").slideDown(),this.$el.find(".whenPayments").slideUp(),this.$el.find("#discountCodeAccordion").hide()),this.updateConditionalLogic(),this.renderMediaBars()},updateConditionalLogic:function(){for(var e=this.model.get(this.formDataKey),t=0;t<e.length;t++){for(var i=$(this.$el.find(".prototype-element.formElements:not(.prototype)")[t]),a=e[t],n="",r="",o=0;t>o;o++){var s=e[o];if(s.label&&$.inArray(s.type,["checkbox","radio","select"])>-1){var l=a.conditionalElement==s.label?"selected":"";if(n+='<option value="'+inputSafe(s.label)+'" '+l+">"+s.label+"</option>","selected"==l)if("checkbox"==s.type)r+='<option value="true" '+("true"==a.conditionalValue?"selected":null)+">Checked</option>";else for(var d in s.options){var l=a.conditionalValue==s.options[d]?"selected":"";r+='<option value="'+inputSafe(s.options[d])+'" '+l+">"+s.options[d]+"</option>"}}}n.length>0?(n='<option value=""> - Select - </option>'+n,r='<option value=""> - Select - </option>'+r,i.find(".selectConditionalElement").html(n),i.find(".selectConditionalValue").html(r),i.find(".conditionalLogic").show()):i.find(".conditionalLogic").hide()}}},formElementsViewModule.prototype={initialize:function(){var e=this;this.$el.on("click","#submitButton",function(){setTimeout(function(){$(".validity-alert").each(function(){var e=$(this).siblings("label").text();e="Please complete: "+e,$(this).find(".ws-po-box").text(e)})},250)}),this.$el.on("keydown",".realForm input",function(e){return 13==e.keyCode?(e.preventDefault(),!1):void 0}),this.$el.on("change",".addressWrapper [name=country]",function(){var t=$(this).parents(".addressWrapper").find("[name=state]"),i=t.prop("required")?"*":"";i+="US"==$(this).val()?"State":"State / Province",t.attr("placeholder",i),e.backboneView.updateInputFields()}),this.$el.on("click keyup",".radioImage .radioOption",function(e){e.keyCode&&13!=e.keyCode||($(this).parents(".radioImage").find(".radioOption").removeClass("checked"),$(this).addClass("checked"),$(this).find("input").prop("checked",!0).trigger("change"))}),e.$el.on("change",".realForm .select, .realForm .multipleCheckbox, .realForm .radio, .realForm .radioImage",function(){e.calculatePrice()}),e.$el.on("keyup input",".paypalQuantity",function(){e.calculatePrice()}),this.$el.on("keyup",".discountCode",function(){"undefined"!=typeof DISCOUNT_CODE_TIMER&&clearTimeout(DISCOUNT_CODE_TIMER),DISCOUNT_CODE_TIMER=setTimeout(function(){e.model.setLocals({discountCode:""}),debug()("Discount code change detected");var t=e.$el.find(".discountCode").val();if(0==t.length)return e.$el.find(".discountCodeStatus").html(""),void e.calculatePrice();for(var i=0;i<e.model.get("discounts").length;i++){var a=e.model.get("discounts")[i];if(t==a.discountCode)return debug()("Valid code"),e.model.setLocals({discountCode:t}),e.$el.find(".discountCodeStatus").removeClass("fadeIn").html('<i class="success fa fa-check"></i>').addClass("fadeIn"),void e.calculatePrice()}debug()("invalid code!"),e.$el.find(".discountCodeStatus").removeClass("fadeIn").html('<i class="fail fa fa-exclamation-triangle"></i>').addClass("fadeIn"),e.calculatePrice()},500)})},renderFormElements:function(e){e=e||!1;var t=this;this.model.syncLocalData();var i=t.model.get("locals").data,a=[],n=[],r={},o=!0;if(t.model.setLocals({lastStep:o}),t.model.get("multistepForm")){var s=t.model.get("locals").previousStepIdxs||[],l=t.model.get("locals").currentStepIdx||0,d=t.model.get("locals").nextStepIdx;if("previous"===e){l=s.pop(),d=null;var u=l+1}else if("next"===e)var u=d+1;else var u=l+1}else var u=0;var c=0,p=0;if(i[0].isDefault)o=!1;else for(;i[u];){var h=i[u];if("page"==h.type?(a.push({meta:r,content:JSON.parse(JSON.stringify(n))}),n=[],r=h):(0!=h.length&&h.label||("radio"==h.type?(c++,h.radioName="(Radio "+c+")"):(p++,h.labelDefault="(No label "+p+")")),n.push(h)),"step"===h.type){o=!1,(e||!d)&&(s[s.length-1]!==l&&d&&s.push(l),d&&(l=d),d=u),t.model.setLocals({currentStepIdx:l,nextStepIdx:d,previousStepIdxs:s,lastStep:o});break}u++}o?(t.model.setLocals({lastStep:o}),t.model.get("multistepForm")&&d!==i.length&&(s[s.length-1]!==l&&d&&s.push(l),t.model.setLocals({currentStepIdx:d,nextStepIdx:i.length,previousStepIdxs:s})),$("#submitButton").text(t.model.get("buttonText")),t.model.get("paymentRequired")&&t.model.get("showPriceSummary")&&$("#submitButton").text(t.calculatePrice()),$(".discountCodeField").removeClass("hidden"),$(".quantityField").removeClass("hidden"),$(".recaptchaContent").find("input").prop("required",!0),$(".recaptchaContent").removeClass("hidden"),t.backboneView.buildCaptcha()):($("#submitButton").text("Next"),$(".discountCodeField").addClass("hidden"),$(".recaptchaContent").find("input").prop("required",!1),$(".quantityField").addClass("hidden"),$(".recaptchaContent").addClass("hidden")),s&&s.length?$("#formBackButton").show():this.$el.find("#formBackButton").hide(),n.length>0&&a.push({meta:r||{},content:n}),t.model.setLocals({pages:a}),t.renderPage(0)},isLastPage:function(){return this.model.get("locals").page==this.model.get("locals").pages.length-1},signatureDependences:function(){if(!window.signatureDependencesLoaded){var e="/public-assets";$.ajax({url:e+"/html2canvas.min.js",dataType:"script"}),window.signatureDependencesLoaded=!0}},setupSignatureImage:function(e){var t,i=this,a=1e3,n=$(e),r=$(e).next(".signatureName"),o=this.$el.find(".submitButton");n.on("keyup",function(){clearTimeout(t),n.val().length>0?($(e).keypress(function(e){13==e.keyCode&&e.preventDefault()}),o.attr("disabled",!0),r.show(),r.next(".signatureImage")&&r.next(".signatureImage").remove(),r.text($(e).val()),i.signatureDependences(),t=setTimeout(function(){i.signatureToImage(r)},a)):($(e).next(".signatureName").text(""),r.next(".signatureImage")&&r.next(".signatureImage").remove())}),n.on("keydown",".signatureInput",function(){clearTimeout(t)})},signatureToImage:function(e){var t=$(e),i=this.$el.find(".submitButton");html2canvas(t,{useCORS:!0,onrendered:function(e){var a=e.toDataURL("image/png");t.after('<img class="signatureImage" src="'+a+'" />'),t.next(".signatureImage").length&&t.next(".signatureImage").prop("src").length<10&&t.next(".signatureImage").remove(),t.hide(),i.attr("disabled",!1)}})},clearValidationErrors:function(){debug()("Clearing validation errors"),this.$el.find("#validationErrors").hide(),this.$el.find("#uploadErrors").hide(),this.$el.find("#noBusinessErrors").hide(),this.$el.find(".captchaInput").toggleClass("errors",!1),this.$el.find("#spamDetection").hide()},showValidationErrors:function(){debug()("Show validation errors"),this.$el.find("#validationErrors").fadeIn(),this.backboneView.updateInputFields()},showUploadErrors:function(){debug()("Show upload errors"),this.$el.find("#uploadErrors").fadeIn(),this.backboneView.updateInputFields()},dateIsNow:function(e){var t=e.split(", ")[0],i=e.split(", ")[1],a=new Date,n=(a.getMonth()+1).toString()+"/"+a.getDate().toString()+"/"+a.getFullYear().toString(),r=a.getDate().toString()+"/"+(a.getMonth()+1).toString()+"/"+a.getFullYear().toString(),o=a.getMinutes()<10?"0"+a.getMinutes().toString():a.getMinutes().toString(),s=a.getHours()%12+1+":"+o+(a.getHours()>=12?"PM":"AM"),l=a.getHours()+":"+o;return!(t!==n&&t!==r||i!==s&&i!==l)},elementIsPresent:function(e){var t=this.model.view.$el.find("#"+e.idx.toString());if(!e.conditionalValue)return!0;if(this.elementInCurrentStep(e)&&t[0]&&"none"!==t.css("display"))return!0;var i=this.model.get("locals").data.filter(function(t){return t.label===e.conditionalElement});if(i.length>1)return!1;var a=i[0],n=a.selectedOption===e.conditionalValue;if(a.checked)var r=a.checked.toString()===e.conditionalValue;else var r=!1;return n||r},elementInCurrentStep:function(e){if(!this.model.get("multistepForm"))return!0;var t=this.model.view.$el.find("#"+e.idx.toString());if(!t[0])return!1;var i=this.model.get("locals").previousStepIdxs,a=this.model.get("locals").currentStepIdx,n=i[i.length-1];return e.idx>n&&e.idx<a},highlightBlankRequiredFields:function(){var e=this,t=[];return this.model.get("locals").data?(this.model.get("locals").data.forEach(function(i){var a=e.model.view.$el.find("#"+i.idx.toString());i.idx>e.model.get("locals").nextStepIdx||!i.required||i.value||!e.elementIsPresent(i)||i.selectedOption||i.checked||i.defaultChecked||i.selectedOptions||i.country||i.dateTimeHidden&&!e.dateIsNow(i.dateTimeHidden)||"none"===a.css("display")||(t.push(i),e.$el.find("#"+i.idx+".formElement").find("input, textarea, select, label, button").addClass("requiredAndBlank"),a.find("#"+i.idx.toString()+"_errors").remove(),a.append('<p style="color: red" id="'+i.idx.toString()+'_errors">Please enter a valid input</p>'),e.$el.find("input.requiredAndBlank, textarea.requiredAndBlank").first().focus())}),t.length>0):void 0},validate:function(){var e=this;e.clearValidationErrors();var t=e.highlightBlankRequiredFields(),i="";if(e.$el.find("input.email").each(function(){return $(this).val().search("@")>-1?void(i=$(this).val()):void $(this).hasClass("requiredAndBlank")}),0==i.length&&e.$el.find('input[type="text"]').each(function(){return $(this).val().search("@")>-1?void(i=$(this).val()):void 0}),i.length>0&&deliverHash(i),"function"==typeof e.$el.find(".realForm")[0].checkValidity){var a=e.$el.find(".realForm")[0].checkValidity();if(0==a)return debug()("Validity is false. Do not submit!"),e.showValidationErrors(),!1}var n=!0;e.$el.find("input.email[required]").each(function(){return-1==$(this).val().search("@")?(n=!1,!1):void 0});var r=!0;e.$el.find(".multipleCheckbox").each(function(){return $(this).hasClass("hiddenRequired")&&0==$(this).find('input[type="checkbox"]:checked').length?(r=!1,!1):void 0});var o=!0;if(e.$el.find("input.hiddenRequired").each(function(){return 0==$(this).val().length?(o=!1,!1):void 0}),0==n||0==r||0==o)return debug()("Form validity false"),e.showValidationErrors(),!1;var s=!0;if(e.$el.find(".fileURL").each(function(){return $(this).data("currently-uploading")?(s=!1,!1):void 0}),0==s)return debug()("Form validity false"),e.showUploadErrors(),!1;var l=!0;if(e.$el.find(".textarea").each(function(){var e=$(this).find("textarea");return e.data("limiting")&&parseInt(e.data("max"))&&0!=parseInt(e.data("max"))&&parseInt(e.data("max"))<e.val().length?($(this).find(".lengthErrors").fadeIn(),l=!1,!1):void 0}),0==l)return debug()("Form validity false"),!1;if(e.model.get("locals").isDirty){$(".saveModal").modal();var d=e.model.get("data");return"step"===d[d.length-1].type&&(d.pop(),this.model.set({data:d}),this.model.settings.handleMultistepForms()),!1}if(e.model.get("paymentRequired")&&0==e.model.get("paypalPaypalAccount").length)return e.$el.find("#noBusinessErrors").show(),!1;if(e.model.get("locals").isDirty)return $(".saveModal").modal("show"),!1;if(""!=e.$el.find(".honeypot").val())return e.$el.find("#spamDetection").show(),!1;var u=(new Date).getTime()-e.model.get("locals").loadTime;return 2100>u?(e.$el.find("#spamDetection").show(),!1):t?!1:!0},renderPage:function(e,t){var i=this,a=i.model.get("locals").pages,n=this.model;i.model.setLocals({page:e});var r=t;t=function(){"blockLabels"==i.model.get("labelType")&&i.$el.find("input,textarea").each(function(){$(this).attr("placeholder","")}),r&&r()},this.$el.on("click focus",".signatureInput",function(){i.setupSignatureImage(this)});for(var o=this.$el.find(".dynamicElements"),s=a[e]||{meta:{},content:[]},l="",d=0,u=0;u<s.content.length;u++){var c=JSON.parse(JSON.stringify(s.content[u])),p=$("#formElementTemplate").html();if(c.options){var h=[];for(var m in c.options)c.options.hasOwnProperty(m)&&c.options[m]&&c.options[m].length>0&&h.push({name:c.options[m],price:parseFloat((c.prices||[])[m])||0})}var f=_.template(p,{m:n.attributes,item:$.extend(c,{options:h}),view:i,idx:c.idx});c.half?d++:d=0,3==d&&(d=1,f='<div class="elementWrapper">'+f+"</div>"),l+=f}o.hide().html(l).fadeIn(function(){i.backboneView.postSizeToSocket(),t&&t(),$(this).toggleClass("visible",!0)}),i.$el.find(".textarea").each(function(){var e=$(this);e.find("textarea").on("keyup",function(){e.find(".currentLength").text($(this).val().length.toString()+" out of "+$(this).data("max").toString()+" characters"),$(this).val().length>parseInt($(this).data("max"))?e.find(".lengthErrors").fadeIn():e.find(".lengthErrors").fadeOut()})}),i.updateConditionalElements();var g=i.model.get("title");s.meta.name&&s.meta.name.length>0&&(g=s.meta.name);var v=i.$el.find(".formTitle");0==e?v.text(g):v.text().trim()!=g&&v.fadeOut(function(){v.text(g),v.fadeIn()});var y=i.model.get("buttonText");s.meta.buttonText&&s.meta.buttonText.length>0&&(y=s.meta.buttonText);i.$el.find(".submitButton");if("blockLabels"==this.model.get("labelType")&&this.$el.find('input:not([name="password"]), textarea').attr("placeholder",""),n.get("multistepForm")){var b=n.get("data").filter(function(e){return"step"===e.type}).length,w=n.get("locals").previousStepIdxs.length+1;n.view.$el.find(".stepLabel").html(w.toString()+"/"+b.toString())}if(i.isLastPage()){if(i.model.get("paymentRequired")&&i.model.get("redirectLink").length>0){var k=POWr.paypalRedirectUrl(i.model.get("redirectLink"));i.$el.find(".paypalButton [name=return]").val(k)}$("input").each(function(){$(this)[0].oninvalid=function(e){if(e.target.setCustomValidity(""),!e.target.validity.valid){var t="Please complete: "+$(this).attr("title");e.target.setCustomValidity(t),$(e.target).siblings(".validity-alert").find(".ws-po-box").text(t)}},$(this)[0].oninput=function(e){e.target.setCustomValidity("")}})}if("undefined"!=typeof INITIALIZING_EXTRA_PICKERS&&clearTimeout(INITIALIZING_EXTRA_PICKERS),INITIALIZING_EXTRA_PICKERS=setTimeout(function(){void 0!=i.backboneView.initializeDateTimePickers&&i.backboneView.initializeDateTimePickers(),i.initializeFileUploaders(),i.initializeUrlInputs()},1500),i.preventMultipleSubmission()){i.$el.find(".realForm input, .realForm textarea, .realForm select").prop("disabled",!0);var D="You've already submitted a response";i.$el.find("input").attr("title",D),i.$el.find(".submitButton").attr("title",D),i.$el.on("click",function(){i.$el.find("#alreadySubmittedErrors").slideDown()})}i.ieNumberHotfix(),i.calculatePrice()},updateConditionalElements:function(){var e=this,t=0;this.$el.find(".formElement").each(function(){var i=$(this),a=e.model.get(e.formDataKey)[$(i).prop("id")];if(a.conditionalElement&&a.conditionalValue){var n=null;e.model.get("locals").data.forEach(function(e){a.conditionalElement===e.label&&(n=e)}),n.selectedOption===a.conditionalValue||void 0!==n.checked&&n.checked.toString()===a.conditionalValue?(i.slideDown("fast"),i.find(".rememberRequired").prop("required",!0).prop("disabled",!1),i.find(".rememberHiddenRequired").addBack(".rememberHiddenRequired").toggleClass("hiddenRequired",!0).toggleClass("rememberHiddenRequired",!1)):(i.hide(),i.find("[required]").toggleClass("rememberRequired",!0).prop("required",!1).prop("disabled",!0),i.find(".hiddenRequired").addBack(".hiddenRequired").toggleClass("hiddenRequired",!1).toggleClass("rememberHiddenRequired",!0))}else i.slideDown("fast"),i.find(".rememberRequired").prop("required",!0).prop("disabled",!1),i.find(".rememberHiddenRequired").addBack(".rememberHiddenRequired").toggleClass("hiddenRequired",!0).toggleClass("rememberHiddenRequired",!1);t+=1})},saveData:function(){var e=this;setCookie("Form_"+e.model.meta.id+"_progress",JSON.stringify(e.model.get("locals")),7)},currentPageData:function(){var e=this,t=this.$el.find(".realForm"),i=[],a=1,n=t.find('input[type="text"], input[type="date"], input[type="email"], input[type="password"], input[type="hidden"], input[type="number"], textarea, select, .radio, .radioImage, .multipleCheckbox, .checkbox input[type="checkbox"], input.fileURL, input[type="tel"], input[type="url"], input[type="signature"], .addressWrapper'),r="",o=[],s={};n.each(function(){for(var t=["captchaInput","honeypot","dateSelector","timeSelector","ignoreThis"],n=0;n<t.length;n++)if($(this).hasClass(t[n]))return!0;if("none"==$(this).closest(".formElement").css("display"))return!0;if($(this).hasClass("addressWrapper")){var l=$(this).data("is-shipping-address"),d=$(this).formToObject();if(e.model.get("paymentRequired")&&l)state_codes={alabama:"AL",alaska:"AK",arizona:"AZ",arkansas:"AR",california:"CA",colorado:"CO",connecticut:"CT",delaware:"DE","district of columbia":"DC",florida:"FL",georgia:"GA",hawaii:"HI",idaho:"ID",illinois:"IL",indiana:"IN",iowa:"IA",kansas:"KS",kentucky:"KY",louisiana:"LA",maine:"ME",maryland:"MD",massachusetts:"MA",michigan:"MI",minnesota:"MN",mississippi:"MS",missouri:"MO",montana:"MT",nebraska:"NE",nevada:"NV","new hampshire":"NH","new jersey":"NJ","new mexico":"NM","new york":"NY","north carolina":"NC","north dakota":"ND",ohio:"OH",oklahoma:"OK",oregon:"OR",pennsylvania:"PA","rhode island":"RI","south carolina":"SC","south dakota":"SD",tennessee:"TN",texas:"TX",utah:"UT",vermont:"VT",virginia:"VA",washington:"WA","west virginia":"WV",wisconsin:"WI",wyoming:"WY","british columbia":"BC",ontario:"ON","newfoundland and labrador":"NL","nova scotia":"NS","prince edward island":"PE","new brunswick":"NB",quebec:"QC",manitoba:"MB",saskatchewan:"SK",alberta:"AB","northwest territories":"NT",nunavut:"NU","yukon territory":"YT",agrigento:"AG",alessandria:"AL",ancona:"AN",aosta:"AO",arezzo:"AR","ascoli piceno":"AP",asti:"AT",avellino:"AV",bari:"BA",belluno:"BL",benevento:"BN",bergamo:"BG",biella:"BI",bologna:"BO",bolzano:"BZ",brescia:"BS",brindisi:"BR",cagliari:"CA",caltanissetta:"CL",campobasso:"CB",caserta:"CE",catania:"CT",catanzaro:"CZ",chieti:"CH",como:"CO",cosenza:"CS",cremona:"CR",crotone:"KR",cuneo:"CN",enna:"EN",ferrara:"FE",firenze:"FI",foggia:"FG","forli-cesena":"FO",frosinone:"FR",genova:"GE",gorizia:"GO",grosseto:"GR",imperia:"IM",isernia:"IS","la spezia":"SP","l\u2019aquila":"AQ",latina:"LT",lecce:"LE",lecco:"LC",livorno:"LI",lodi:"LO",lucca:"LU",macerata:"MC",mantova:"MN","massa-carrara":"MS",matera:"MT",messina:"ME",milano:"MI",modena:"MO","monza e brianza":"MB",napoli:"NA",novara:"NO",nuoro:"NU",oristano:"OR",padova:"PD",palermo:"PA",parma:"PR",pavia:"PV",perugia:"PG",pesaro:"PS",pescara:"PE",piacenza:"PC",pisa:"PI",pistoia:"PT",pordenone:"PN",potenza:"PZ",prato:"PO",ragusa:"RG",ravenna:"RA","reggio calabria":"RC","reggio emilia":"RE",rieti:"RI",rimini:"RN",roma:"RM",rovigo:"RO",salerno:"SA",sassari:"SS",savona:"SV",siena:"SI",siracusa:"SR",sondrio:"SO",taranto:"TA",teramo:"TE",terni:"TR",torino:"TO",trapani:"TP",trento:"TN",treviso:"TV",trieste:"TS",udine:"UD",varese:"VA",venezia:"VE","verbania-cusio-ossola":"VB",vercelli:"VC",verona:"VR","vibo valentia":"VV",vicenza:"VI",drenthe:"DR",flevoland:"FL",friesland:"FR",gelderland:"GE",groningen:"GR",limburg:"LI","noord-brabant":"NB","noord-holland":"NH",overijssel:"OV",utrecht:"UT",zeeland:"ZE","zuid-holland":"ZH","armed forces americas":"AA","armed forces":"AE","armed forces pacific":"AP","american samoa":"AS",guam:"GU","northern mariana islands":"MP","virgin islands":"VI",viterbo:"VT"},void 0!=state_codes[d.state.toLowerCase()]&&(d.state=state_codes[d.state.toLowerCase()]),e.$el.find(".paypalForm").objectToForm(d);else{var u="";d.address1&&(u+=d.address1+", "),d.address2&&(u+=d.address2+", "),u+=d.city+" "+d.state+" "+d.zip+" "+d.country;var c=$(this).data("label");0==(c||"").length&&(c="(Address "+a+")",a++),Object.prototype.hasOwnProperty.call(s,c)?(s[c]=s[c]+1,c=c+"_"+s[c]):s[c]=0,i.push({type:"address",label:c,value:u})}return!0}var p={},c=$(this).attr("name");0!=(c||"").length||$(this).hasClass("radio")||$(this).hasClass("radioImage")?($(this).hasClass("radio")||$(this).hasClass("radioImage"))&&(c=$(this).find("label").first().html()):(c="(No label "+a+")",a++);var h=($(this).data("export-field")||"").trim();p.exportField=h,Object.prototype.hasOwnProperty.call(s,c)?(s[c]=s[c]+1,c=c+"_"+s[c]):s[c]=0;var m=$(this).val(),f=$(this).attr("type");if("checkbox"==f&&(m=$(this).prop("checked")?!0:!1),$(this).hasClass("multipleCheckbox")){var g=[];$(this).find('input[type="checkbox"]:checked').each(function(){g.push($(this).val())}),m=g.join(", ")}if(($(this).hasClass("radio")||$(this).hasClass("radioImage"))&&(m=$(this).find('[type="radio"]:checked').val()),"email"==f&&$(this).data("send-confirmation-email")&&(r=m),"email"==f&&$(this).data("subscribe")&&(debug()("Adding subscribe email"),o.push(m)),p.type=$(this).data("form-type"),"file"==p.type?(p.aws_key=$(this).data("aws-key"),p.upload_id=$(this).data("upload-id")):"datetime"==p.type||"date"==p.type||"time"==p.type?(p.timezone=(new Date).getTimezoneOffset(),p.date_format=$(this).attr("data-format"),p.is_twenty_four=$(this).attr("data-is-twenty-four")):"paypalQuantity"==p.type&&(c=e.model.get("quantityLabel"),m=e.model.get("locals").quantity),p.label=c,p.value=m,"radio"==f&&$(this).prop("required")&&(debug()("Required radio label is "+p.label),p.label=p.label.replace("*","")),debug()("Current data is ",p),"signature"==f){var v=$(this).next(".signatureName").next(".signatureImage").prop("src");v&&(p.value=v)}i.push(p)});var l=e.model.get("locals").page||0;return i=i.map(function(e){return e.page=l,e}),debug()("page data is ",i),{data:i,confirmationEmail:r,subscribeEmail:o.join(","),responseToken:e.model.get("locals").responseToken}},ieNumberHotfix:function(){$('[type="number"]').keydown(function(e){return 38==e.keyCode?($(e.target).val(parseInt($(e.target).val())+1),!1):40==e.keyCode?($(e.target).val(parseInt($(e.target).val())-1),!1):void 0})},calculatePrice:function(){var e=this;if("Recurring"==e.model.get("paypalPurchaseType"))var t=parseFloat(e.model.get("paypalSubscriptionPrice"));else{var t=parseFloat(e.model.get("paypalItemCost"));isNaN(t)&&(t=0)}var i="none",a=0,n=e.model.get("locals").discountCode;if(void 0!=n&&n.length>0)for(var r=0;r<e.model.get("discounts").length;r++){var o=e.model.get("discounts")[r],s=o.discountAmount||0;if(n==o.discountCode){"flat"==o.discountType?(i="flat",a=Math.abs(parseFloat(s))):"rate"==o.discountType&&(i="rate",a=Math.abs(parseFloat(s)/100));break}}var l=[];e.model.get("locals").data.forEach(function(e){$.inArray(e.type,["select","multipleCheckbox","radio","radioimage"])>-1&&l.push(e)}),l.forEach(function(e){if("radio"===e.type||"select"===e.type||"radioimage"===e.type){if(!e.selectedOption)return;var i=e.options.indexOf(e.selectedOption);if(e.prices){var a=parseFloat(e.prices[i]);isNaN(a)||(t+=a)}}else if("multipleCheckbox"===e.type){if(!e.selectedOptions)return;e.selectedOptions.forEach(function(i){var a=e.options.indexOf(i),n=parseFloat(e.prices[a]);isNaN(n)||(t+=n)})}}),"rate"==i&&(t=(1-a)*t),t>0?t=t.toFixed(2):0>t&&(t=0);var d=1;e.model.get("showQuantityInput")&&(d=parseInt(e.$el.find(".paypalQuantity").val())||e.model.get("paypalQuantity")||1);var u=d*t;return"flat"==i&&(u-=a),e.model.setLocals({currentPrice:t,fullPrice:u,quantity:d}),e.model.get("paymentRequired")&&e.model.get("locals").lastStep&&e.model.get("showPriceSummary")&&e.$el.find("#submitButton").text(e.model.get("buttonText")+" "+e.priceToString(u)),e.$el.find('[name="item_name"]').val(d>1?d+" x "+e.model.get("paypalItemName"):e.model.get("paypalItemName")),e.priceToString(u)},priceToString:function(e){var t=this,i={USD:"$",EUR:"\u20ac",GBP:"\xa3",JPY:"\xa5"}[t.model.get("paypalCurrencyCode")]||"";return 0>e&&(i="-"+i,e*=-1),i+e.toFixed(2)+(i.length>0?"":" "+t.model.get("paypalCurrencyCode"))},optionPriceToString:function(e){return(e>0?"+":"")+this.priceToString(e)},preventMultipleSubmission:function(){return this.model.get("preventMultiple")&&"blocked"==getCookie("powr_form_"+this.model.meta.id)&&!window.APP_SETTINGS},initializeFileUploaders:function(){var e=this;$(".uploadSuccessful").hide(),$(".uploadFail").hide();var t=!1;if(!/MSIE\s+(7|8|9)/.test(navigator.userAgent)){var i=navigator.userAgent.toLowerCase().match(/Android\s+([\d\.]+)/);if(!_.isEmpty(i)){var a=navigator.userAgent.toLowerCase().match(/Android\s+([\d\.]+)/)[1],n=parseFloat(a.slice(a.indexOf("Android")+8));4.4>n&&(t=!0)}}if(t)return void this.$el.on("click touchstart keyup",".uploadBtn",function(e){if(!e.keyCode||13==e.keyCode){var t=$(this).parents(".fileUploadParent");t.find(".uploadFail").show(),t.find(".uploadIcon").hide(),t.find(".fileInputName").html('<i class="fa fa-warning"></i> Please use a more recent browser to upload file')}});var r=function(){e.$el.find(".fileUploadInput").each(function(t,i){var a=$(i),n=a.parents(".fileUploadParent"),r=n.find('input[type="submit"]'),o=n.find(".progress-bar"),s=n.find(".progressContainer"),l=$(n).find(".fileURL");n.find(".uploadBtn").on("click touchstart keyup",function(e){e.keyCode&&13!=e.keyCode||n.find(".fileUploadInput").trigger("click")}),$(a).on("change",function(e){var t=e.currentTarget.files,i=(t[0].size/1024/1024).toFixed(4);$(this).data("filesize",i)});var d=JSON.parse(JSON.stringify(e.form_data));d.key=d.key.replace("/${filename}","/"+t+"-${filename}"),a.fileupload({fileInput:a,url:"//"+e.direct_post_url,type:"POST",autoUpload:!1,formData:d,paramName:"file",dataType:"XML",replaceFileInput:!1,progressall:function(e,t){var i=parseInt(t.loaded/t.total*100,10);o.css("width",i+"%"),o.attr("aria-valuenow",i)},add:function(e,t){var i;i="wix"==HOST&&Date.parse(META.created_at)>Date.parse("Mon, 3 July 2017 14:30:00 -0700")?{free:0,premium:5,pro:25,enterprise:100}:{free:0,premium:5,pro:10,enterprise:100};var n=META.premium_status;$(this).attr("filesize")&&(n=$(this).attr("filesize"));var l=i[n];if(a.data("filesize")>l){var d="File larger than the permitted size!";s.show(),r.prop("disabled",!1),o.css("width","100%"),o.css("background","red").text(d),a.wrap("<form>").closest("form").get(0).reset(),a.unwrap()}else t.submit()},start:function(){$(i).trigger("upload_start"),r.prop("disabled",!0),s.show(),o.css("width","0%"),o.css("background","").text(""),n.find(".uploadSuccessful").hide(),n.find(".uploadFail").hide(),l.data("currently-uploading",!0)},done:function(t,a){r.prop("disabled",!1),s.hide(),o.css("width","0%"),o.attr("aria-valuenow","0"),$(".uploadIcon").hide(),debug()("AWS Response: ",a);var d=$(a.jqXHR.responseXML).find("Key").text(),u=$(a.jqXHR.responseXML).find("Location").text();l.val(u),l.data("aws-key",d),l.data("currently-uploading",!1);var c={url:"/app_form_response/upload",data:{filesize:a.total,key:d,id:e.model.meta.id},type:"POST"},p=n.find(".fileUploadInput").val();if(p){var h=p.lastIndexOf(p.indexOf("\\")>=0?"\\":"/"),m=p.substring(h);(0===m.indexOf("\\")||0===m.indexOf("/"))&&(m=m.substring(1)),n.find(".fileInputName").html(m)}ajaxController(c,function(e){e.success?(l.data("upload-id",e.upload_id),$(i).trigger("upload_success"),n.find(".uploadSuccessful").show()):($(i).trigger("upload_fail"),n.find(".uploadFail").show())})},fail:function(e,t){r.prop("disabled",!1),"Uploaded bytes exceed file size"===t.messages.uploadedBytes?o.css("background","red").html("File exceeds file size limit!"):o.css("background","red").text("Failed"),a.wrap("<form>").closest("form").get(0).reset(),a.unwrap()}})})};if(!e.direct_post_url&&e.$el.find(".fileUploadInput").length>0){var o={url:"/form_uploader.json",type:"get",data:{app_id:e.model.meta.id}};ajaxController(o,function(t){t.success&&(e.direct_post_url=t.direct_post_url,e.form_data=t.form_data,r())})}else r()},initializeUrlInputs:function(){this.$el.find('input[type="url"]').each(function(){$(this).blur(function(){var e=$(this),t=e.val();t&&!t.match(/^http([s]?):\/\/.*/)&&e.val("http://"+t)})})},numberHack:function(e){return/^[0-9]/.test(e)?"*"+e:e}},$(function(){formBuilderBaseModel=appModel.extend({baseDefaults:function(){var e={defaultDateFormat:"MM-DD-YYYY",afterSubmission:"clearAndPrevent",preventMultiple:!1,redirectLink:"",ownerEmail:"",carrier:"",carrierLabel:"",phoneNumber:"",phoneValid:!1,pattern:!1,printable:!1,patternType:"subtle_white_feathers",multistepForm:!1,title:"Form Title",description:"",data:[{type:"text",label:"Example text field",half:!1,required:!1,isDefault:!0},{type:"select",label:"Example Dropdown",options:["Option 1","Option 2","Option 3"],half:!1,required:!1,isDefault:!0},{type:"textarea",label:"Example textarea",half:!1,required:!1,isDefault:!0},{type:"radio",label:"Example Radio",options:["Option A","Option B","Option C"],half:!1,required:!1,radioAlign:"horizontal",isDefault:!0}],mailchimpList:"",mailchimpListName:"",emailSubject:"",emailBody:"",emailName:"",emailAddress:"",customAdminEmails:!1,adminSubjectVariable:"",adminEmailName:"",adminSubjectMessage:"",includeSkippedFields:!1,paymentRequired:!1,paypalQuantity:1,quantityLabel:"Quantity",paypalButtonText:"Purchase",showQuantityInput:!1,showPriceSummary:!0,paypalPaypalAccount:"",paypalCurrencyCode:"USD",paypalPurchaseType:"BuyNow",paypalItemName:"My product",paypalItemCost:"",paypalAllowUserToSpecifyPrice:!1,paypalAllowUserToSpecifyQuantity:!1,paypalTrialOn:!1,paypalTrialPrice:0,paypalTrialDuration:30,paypalTrialDurationUnits:"D",paypalSubscriptionPrice:10,paypalSubscriptionDuration:1,paypalSubscriptionDurationUnits:"M",paypalShippingCost:"",paypalNoShipping:"0",titleFontFamily:"Open Sans",titleFontSize:"28px",titleFontColor:"rgb(56, 56, 56)",textFontFamily:"Open Sans",textFontSize:"12px",textFontColor:"rgb(86, 86, 86)",googleSheetsConnected:!1,buttonBackgroundColor:"rgb(86, 86, 86)",buttonColor:"#FFF",buttonRadius:"4px",backgroundGradient:!1,backgroundColor:"#FFF",backgroundStartColor:"#d5d5d5",backgroundEndColor:"#333",backgroundBorderColor:"rgb(238, 238, 238)",backgroundBorderRadius:"4px",backgroundBorderWidth:"1px",backgroundShadow:"none",inputBackgroundColor:"#FFF",inputBorderRadius:"4px",inputFontColor:"#333",inputFontSize:"12px",inputFontFamily:"Open Sans",discountCodeText:"Discount Code",discounts:[],passwordProtectOn:!1,titleAlign:"left",successText:"Received. Thank you!",buttonText:"Submit",buttonAlign:"leftBtn",captchaRequired:!1,labelType:"inlineLabels",pluginWidth:"500px",introAnimation:"none",buttonAnimation:"none",customCSS:"",customJS:""};
return"wix"==HOST&&(e.titleFontColorWix="color-3",e.textFontColorWix="color-4",e.inputBackgroundColorWix="color-1",e.inputFontColorWix="color-4",e.backgroundColorWix="color-1",e.backgroundStartColorWix="color-1",e.backgroundEndColorWix="color-2",e.buttonColorWix="color-1",e.buttonBackgroundColorWix="color-4",e.backgroundBorderColorWix="color-4",e.pluginWidth="1000px"),e},presets:function(){var e={titleFontColor:"color",textFontColor:"color",inputBackgroundColor:"backgroundColor",inputFontColor:"color",backgroundColor:"backgroundColor",backgroundStartColor:"backgroundColor",backgroundEndColor:"backgroundColor",buttonColor:"backgroundColor",buttonBackgroundColor:"color",backgroundBorderColor:"color",titleFontFamily:"fontFamily",textFontFamily:"fontFamily"};return e},syncLocalData:function(e){e=e||!1;var t=this,i=this.get("locals"),a=i.data&&i.data.length,n=JSON.parse(JSON.stringify(this.get("data")));n=n.map(function(n,r){if(n.idx=r,e)document.cookie="Form_"+t.meta.id+"_progress=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";else{var o=a?i.data[r]:null;o&&!i.data[0].isDefault&&["value","src","selectedOption","dateTimeHidden","selectedOptions","address1","address2","city","state","zip","country","checked"].forEach(function(e){n[e]=o[e]})}return n}),this.setLocals({data:n})}}),formBuilderAppModel=formBuilderBaseModel,orderFormAppModel=formBuilderBaseModel,contactFormAppModel=formBuilderBaseModel,mailingListAppModel=formBuilderBaseModel,surveyAppModel=formBuilderBaseModel,pollAppModel=formBuilderBaseModel,wixDevAppModel=formBuilderAppModel,stagingDevAppModel=formBuilderAppModel,localDevAppModel=formBuilderAppModel,formBuilderAppSettings=appSettings.extend({beforeInitialize:function(){var e=this;e.formElementsSettingsModule=new formElementsSettingsModule(this,{formDataKey:"data",paymentRequiredKey:"paymentRequired"}),e.model.settings=e},googleSheetsAuthSuccess:function(){this.$el.find("[name=connectToGoogleSheets]").prop("checked",!0),this.$el.find("[name=includeSkippedFields]").prop("checked",!0),this.$el.find(".sheetButton").prop("href",this.model.meta.external_data.sheet_url),this.update()},afterInitialize:function(){var e=this,t=(this.model,this.$el);t.on("click",".triggerElementModal",function(){$(this).hasClass("premium")||t.find("#elementsModal").modal("show")}),t.on("change","[name=showResponse]",function(){debug()("Change in show response detected"),$(this).prop("checked")&&(debug()("Prop is checked, changing aftersubmission"),t.find("[name=afterSubmission]").val("responses").trigger("change"),"wix"==HOST&&Wix.UI.set("afterSubmission",{value:"responses"}))}),t.on("change","[name=googleSheetsConnected]",function(){e.model.meta.external_data&&e.model.meta.external_data.google_sheets_connected?e.model.set($(this).hasClass("on")?{googleSheetsConnected:!1}:{googleSheetsConnected:!0}):(window.name=e.model.meta.id,window.open("/google/connect_sheets/"+e.model.meta.id,"_blank"))}),this.updatePaymentVisibility(),this.updateAdminEmailVisibility(),e.initializePaypalSettings("paypal"),e.initializeAutocompletes(),e.loadTemplates(),e.updateConditionals(),t.on("click",".phoneSuccess",function(){var t=$(this),i=function(e){t.children().not(e).slideUp(),t.find(e).slideDown()};if("free"!=e.model.meta.premium_status)if(e.model.get("phoneValid")){var a=parseInt(t.data("last-sent")||0),n=15e3;(new Date).valueOf()-a>n?(i(".duringSent"),t.data("last-sent",(new Date).valueOf()),ajaxController({url:"/form-responses/send-text",data:{id:e.model.meta.id,carrier:e.model.get("carrier"),number:e.model.get("phoneNumber")},type:"POST"},function(e){e.success&&i(".afterSent")})):(i(".alreadySending"),window.ALREADY_SENDING_TIMEOUT&&clearTimeout(ALREADY_SENDING_TIMEOUT),ALREADY_SENDING_TIMEOUT=setTimeout(function(){i(".beforeSent")},n-((new Date).valueOf()-a)))}else i(".sendInvalid"),window.SEND_INVALID_TIMEOUT&&clearTimeout(SEND_INVALID_TIMEOUT),SEND_INVALID_TIMEOUT=setTimeout(function(){i(".beforeSent")},2500)}),t.on("change","[name=afterSubmission]",function(){"clearAndAllow"==$(this).val()&&(t.find("[name=preventMultiple]").prop("checked",!1).trigger("change"),e.updateConditionals())}),t.on("change","[name=sendConfirmationEmail]",function(){$(this).prop("checked")&&(t.find("[name=sendConfirmationEmail]").prop("checked",!1),$(this).prop("checked",!0))}),t.on("change","[name=isShippingAddress]",function(){$(this).prop("checked")&&(t.find("[name=isShippingAddress]").prop("checked",!1),$(this).prop("checked",!0))}),t.on("click",".mailchimpButton",function(){"free"!=e.model.meta.premium_status&&window.open("/mailchimp/connect/"+e.model.meta.id+"?external_user_id="+(e.model.meta.external_user_id||""),"_blank",'toolbar=0,location=0,menubar=0,height=650,width=300,scrollbars=1"')}),t.on("change",'[name="multistepForm"]',function(){e.handleMultistepForms($(this)),e.model.triggerChange()});POWr.simpleCopies("upgrade_required"),POWr.simpleCopies("premium_text_1")},afterUpdate:function(){var e=this;e.formElementsSettingsModule.readFormElements();var t=[];this.$el.find(".ownerEmail.prototype-element:not(.prototype)").each(function(){t.push($(this).find("[name='ownerEmailPart']").val())});var i=t.toString();setCookie("Form_"+this.model.meta.id+"_progress",'{"nonexistent": true}',7),this.model.set({ownerEmail:i},{silent:!0}),this.model.triggerChange(),this.updateAdminMessage(),this.updateConditionals(),this.initializeInputs(),this.updatePaymentVisibility(),this.updateAdminEmailVisibility(),this.populateSubjectLineOptions(),this.initializeWixDropdowns(),this.formElementsSettingsModule.updateFormElementConditionals()},afterSort:function(){this.afterUpdate(),this.handleMultistepForms()},populateSubjectLineOptions:function(){var e=this,t=this.$el.find('[name="adminSubjectVariable"]');t.html('<option value="None">None</option>'),this.model.get("data").filter(function(e){return e.label}).forEach(function(i){t.append(e.model.get("adminSubjectVariable")===i.label?'<option selected value="'+i.label+'">'+i.label+"</option>":'<option value="'+i.label+'">'+i.label+"</option>")})},maxNumberOfElements:function(){var e=this.model.get("data").length,t=parseInt(this.$el.find(".triggerElementModal").attr("data-"+this.model.meta.premium_status+"-limit"));return e>t},handleMultistepForms:function(e){e=e||null;var t=this.model.get("data");e?e.prop("checked")?"step"!==t[0].type&&(this.model.setLocals({currenStepIdx:0,previousStepIdxs:[],nextStepIdx:null}),this.model.set({multistepForm:!0,data:[{type:"step"}].concat(t)})):(t=t.filter(function(e){return"step"!==e.type}),this.model.setLocals({currenStepIdx:0,previousStepIdxs:[],nextStepIdx:null}),this.model.set({multistepForm:!1,data:t})):this.model.get("multistepForm")&&!this.maxNumberOfElements()?(this.model.setLocals({currenStepIdx:0,previousStepIdxs:[],nextStepIdx:null}),"step"!==t[0].type&&this.model.set({data:[{type:"step"}].concat(t)})):(t=t.filter(function(e){return"step"!==e.type}),this.model.set({data:t})),this.$el.find("#formBackButton").hide(),this.model.syncLocalData(!0);var i=this.$el.find(".formElements .panel-collapse").map(function(e,t){return"block"===t.style.display?$(t).find(".form-element.hid").prop("id"):void 0}).toArray(),a=this.$el.find(".formElements .hideText").map(function(e,t){return $(t).parent().find(".form-element").first().prop("id")}).toArray(),n=this.$el.find(".connect").scrollTop()||this.$el.find(".wixSection.connectTabSelector").scrollTop();this.model.setLocals({expandedPanels:i,expandedAdvancedSections:a}),this.formElementsSettingsModule.renderFormElements(n),$(".ifMailchimp").show(),this.maxNumberOfElements()&&this.$el.find(".triggerElementModal").addClass("premium")},initializeInputs:function(){this.initializeWixDropdowns(),this.renderEmailMediaBars(),this.initializeCheckboxes(),this.initializeWixCheckboxes(),this.validateExternalFields()},updatePaymentVisibility:function(){var e=this;e.model.get("paymentRequired")?e.$el.find(".paymentOptions").slideDown():e.$el.find(".paymentOptions").slideUp()},updateAdminEmailVisibility:function(){this.model.get("customAdminEmails")?this.$el.find(".customAdminEmails").slideDown():this.$el.find(".customAdminEmails").slideUp()},updateAdminMessage:function(){if("wix"==HOST){var e=this.$el.find("#collapseContent").parent(".panel");$(".tooltip").hide(),e.tooltip("destroy"),0==this.model.get("ownerEmail").length&&e.tooltip({title:"Enter admin email to receive responses"})}},updateConditionals:function(){var e=this;switch(this.model.get("afterSubmission")){case"clearAndPrevent":this.$el.find(".redirectLink").slideUp(),this.$el.find(".successText").slideDown();break;case"clearAndAllow":this.$el.find(".redirectLink").slideUp(),this.$el.find(".successText").slideDown();break;case"redirect":this.$el.find(".redirectLink").slideDown(),this.$el.find(".successText").slideUp();break;case"hide":this.$el.find(".redirectLink").slideUp(),this.$el.find(".successText").slideUp()}"clearAndAllow"==this.model.get("afterSubmission")?this.$el.find(".preventMultipleCheckbox").slideUp():this.$el.find(".preventMultipleCheckbox").slideDown(),this.$el.find(".use-twenty-four").each(function(){var e=$(this).parents(".form-details").find('select[name="displayType"]').val();"date"==e?$(this).slideUp():$(this).slideDown()}),this.model.get("showQuantityInput")?this.$el.find(".quantityDetails").slideDown():this.$el.find(".quantityDetails").slideUp(),this.model.get("pattern")?(this.$el.find(".patternType").show(),this.$el.find(".patternTypeOn").hide()):(this.$el.find(".patternType").hide(),this.$el.find(".patternTypeOn").show()),this.$el.find("[name=displayType]").each(function(){0==$(this).val().length&&$(this).val("both")}),this.$el.find("[name=displayType]").on("change",function(){var e=$(this),t=e.val(),i=e.parents(".formElementsWrapper"),a=i.find('[name="dateFormat"]').parents(".selectWrapper"),n=i.find(".istwentyfourCheckbox").parent();"time"===t?(a.hide(),n.show()):"date"===t?(a.show(),n.hide()):(a.show(),n.show())}),""==this.model.get("carrierLabel")&&""!=this.model.get("carrier")&&this.model.set("carrier",""),this.checkPhoneFormat(),""==this.model.get("mailchimpList")?(this.$el.find(".needsToChoose").slideDown(),this.$el.find(".alreadyChose").slideUp(),this.$el.find(".continueMailchimp").hide(),this.$el.find(".continueMailchimp").css("display","none"),this.$el.find(".ifMailchimp").slideUp(),this.$el.find(".exportField").slideUp()):(this.$el.find(".needsToChoose").slideUp(),this.$el.find(".alreadyChose").slideDown(),this.$el.find(".alreadyChose").find(".mailchimpList").text(this.model.get("mailchimpListName")),this.$el.find(".continueMailchimp").css("display","inline-block"),this.$el.find(".ifMailchimp").slideDown(),this.$el.find(".exportField").slideDown()),this.initializePopovers(),this.makeSortable(".optionsWrapper",".optionsSort",!1),this.makeSortable(".discountWrapper",".discountSort",!0),this.$el.find('[name="limitingCharacters"]').each(function(){$(this).is(":checked")?$(this).closest(".form-details").find(".whenLimiting").slideDown():$(this).closest(".form-details").find(".whenLimiting").slideUp()}),this.hasConfirmationEmail()?this.$el.find(".emailConfirmation").show():this.$el.find(".emailConfirmation").hide(),e.model.meta.external_data&&e.model.meta.external_data.google_sheets_connected&&this.model.attributes.googleSheetsConnected?this.$el.find(".sheetButton").show():this.$el.find(".sheetButton").hide(),e.formElementsSettingsModule.updateFormElementConditionals()},checkPhoneFormat:function(){var e=this,t=e.model.get("phoneNumber").replace(/\s|\.|-/g,"").replace(/^\+1(?=\d{10})/,"");if(0==t.length)return e.$el.find(".phoneErrors").slideUp(),void(e.model.get("phoneValid")&&e.model.set("phoneValid",!1));if(t.match(/^\d{10}$/)){e.$el.find(".phoneErrors").slideUp(),e.model.get("phoneNumber")!=t&&e.model.set("phoneNumber",t);var i=0!=e.model.get("carrier").length&&"Not supported"!=e.model.get("carrier");e.model.get("phoneValid")!=i&&e.model.set("phoneValid",i)}else e.$el.find(".phoneErrors").slideDown(),e.model.get("phoneValid")&&e.model.set("phoneValid",!1)},initializeAutocompletes:function(){var e=this;e.$el.find('input[name="carrierLabel"]').blur(function(){var e=$.Event("keydown");e.keyCode=$.ui.keyCode.ENTER,$(this).trigger(e)}).autocomplete({autoFocus:!0,source:function(e,t){for(var i=[{label:"Aio Wireless",value:"aio"},{label:"Alltel",value:"alltel"},{label:"Ameritech",value:"ameritech"},{label:"AT&T",value:"at&t"},{label:"Bell Atlantic",value:"bell-atlantic"},{label:"Bellsouth Mobility",value:"bellsouthmobility"},{label:"BlueSkyFrog",value:"blueskyfrog"},{label:"Boost Mobile",value:"boost"},{label:"Cellular South",value:"cellularsouth"},{label:"Comcast PCS",value:"comcast"},{label:"Cricket",value:"cricket"},{label:"kajeet",value:"kajeet"},{label:"Metro PCS",value:"metropcs"},{label:"Nextel",value:"nextel"},{label:"Powertel",value:"powertel"},{label:"PSC Wireless",value:"pscwireless"},{label:"Qwest",value:"qwest"},{label:"Southern Link",value:"southernlink"},{label:"Sprint PCS",value:"sprint"},{label:"Suncom",value:"suncom"},{label:"T-Mobile",value:"t-mobile"},{label:"Tracfone",value:"tracfone"},{label:"Telus Mobility",value:"telus-mobility"},{label:"Virgin Mobile",value:"virgin"},{label:"Verizon Wireless",value:"verizon"},{label:"Aliant (Canada)",value:"aliant-canada"},{label:"Beeline",value:"beeline-ua"},{label:"Bell Mobility (Canada)",value:"bellmobility-canada"},{label:"BPL Mobile",value:"bpl-mobile"},{label:"Claro (Brazil)",value:"claro-brazil"},{label:"Claro (Nicaragua)",value:"claro-nicaragua"},{label:"Du (UAE)",value:"du-arab-emirates"},{label:"E-Plus (Germany)",value:"e-plus-germany"},{label:"Etisalat (UAE)",value:"etisalat-arab-emirates"},{label:"Fido",value:"fido-canada"},{label:"Manitoba Telecom (Canada)",value:"manitobatelecom-canada"},{label:"Mobinil",value:"mobinil-egypt"},{label:"Mobistar (Belgium)",value:"mobistar-belgium"},{label:"Mobitel",value:"mobitel"},{label:"Movistar (Spain)",value:"movistar-spain"},{label:"NorthernTel (Canada)",value:"northerntel-canada"},{label:"o2 (Germany)",value:"o2-germany"},{label:"o2 (UK)",value:"o2-uk"},{label:"Orange (Mumbai)",value:"orange-mumbai"},{label:"Orange (Netherlands)",value:"orange-netherlands"},{label:"Orange (UK)",value:"orange-uk"},{label:"Rogers Wireless",value:"rogers-wireless"},{label:"Rogers (Canada)",value:"rogers-canada"},{label:"SaskTel (canada)",value:"sasktel-canada"},{label:"SFR (France)",value:"sfr-france"},{label:"T-Mobile (Austria)",value:"t-mobile-austria"},{label:"T-Mobile (Germany)",value:"t-mobile-germany"},{label:"T-Mobile (UK)",value:"t-mobile-uk"},{label:"Telebec (Canada)",value:"telebec-canada"},{label:"Telefonica (Spain)",value:"telefonica-spain"},{label:"Telus (Canada)",value:"telus-canada"},{label:"Virgin (Canada)",value:"virgin-canada"},{label:"Vodafone (Germany)",value:"vodafone-germany"},{label:"Vodafone (Egypt)",value:"vodafone-egypt"},{label:"Vodafone (UK)",value:"vodafone-uk"},{label:"Vodafone (Italy)",value:"vodafone-italy"},{label:"Vodafone (Japan - Chuugoku)",value:"vodafone-jp-chuugoku"},{label:"Vodafone (Japan - Hokkaido)",value:"vodafone-jp-hokkaido"},{label:"Vodafone (Japan - Hokuriko)",value:"vodafone-jp-hokuriko"},{label:"Vodafone (Japan - Kansai)",value:"vodafone-jp-kansai"},{label:"Vodafone (Japan - Osaka)",value:"vodafone-jp-osaka"},{label:"Vodafone (Japan - Kanto)",value:"vodafone-jp-kanto"},{label:"Vodafone (Japan - Koushin)",value:"vodafone-jp-koushin"},{label:"Vodafone (Japan - Tokyo)",value:"vodafone-jp-tokyo"},{label:"Vodafone (Japan - Kyuushu)",value:"vodafone-jp-kyuushu"},{label:"Vodafone (Japan - Okinawa)",value:"vodafone-jp-okinawa"},{label:"Vodafone (Japan - Shikoku)",value:"vodafone-jp-shikoku"},{label:"Vodafone (Japan - Touhoku)",value:"vodafone-jp-touhoku"},{label:"Vodafone (Japan - Niigata)",value:"vodafone-jp-niigata"},{label:"Vodafone (Japan - Toukai)",value:"vodafone-jp-toukai"},{label:"Vodafone (Spain)",value:"vodafone-spain"}],a=e.term.toLowerCase().split(/\s|-/g),n=[],r=0;r<i.length;r++){for(var o=0;o<a.length;o++)a[o].length>0&&(-1!=i[r].label.toLowerCase().indexOf(a[o])||-1!=i[r].label.toLowerCase().replace(/-|&/g,"").indexOf(a[o]))&&(i[r].matches=(i[r].matches||0)+1);i[r].matches>0&&n.push(i[r])}n.sort(function(e,t){return t.matches-e.matches}),n=n.slice(0,5),0==n.length&&n.push({label:"No carriers found",value:""}),t(n)},select:function(t,i){var a=i.item.label,n=i.item.value,r=["at&t"];return-1!=r.indexOf(n)&&(a="Not supported",n="Not supported"),""==a&&(n=""),$(t.target).val(a),e.$el.find('input[name="carrier"]').val(n),e.update(),debug()(t,i),!1}})},setElementsModalImageFlag:function(){this._$addElementModalBtn=this.$el.find(".triggerElementModal"),this._$addElementModal=$("#elementsModal"),this.imagesHaveBeenLoadedAlreadyFlag=this.imagesHaveBeenLoadedAlreadyFlag||!1;var e=function(){var e=$(this),t=e.attr("data-imgurl");e.attr("src",t)},t=function(){var t=$(this),i=t.find("img");i.each(e)};this._$addElementModalBtn.on("click",function(){var e;this.imagesHaveBeenLoadedAlreadyFlag||(this.imagesHaveBeenLoadedAlreadyFlag=!0,e=this._$addElementModal.find(".elementItem"),e.each(t))}.bind(this))},afterRender:function(){var e=this;e.formElementsSettingsModule.renderFormElements();var t=this.model.get("ownerEmail");try{var i=t.split(",");for(var a in i){var n=this.$el.find(".ownerEmailWrapper").addPrototype(null,{speed:"instant"}),r={ownerEmailPart:i[a]};n.objectToForm(r)}}catch(o){debug()("User is not logged in yet!")}this.updateAdminMessage(),this.initializeWixDropdowns(),this.validateExternalFields(),this.updateConditionals(),this.initializeInputs(),this.makeSortable(".formElementsWrapper",".sort",!0),this.setElementsModalImageFlag(),this.populateSubjectLineOptions(),"wix"==HOST&&(Wix.Settings.getDashboardAppUrl(function(t){t+="&powr_app_id="+e.model.meta.id,debug()("Setting dashboard to "+t),e.$el.find(".openDashboard").attr("href",t)}),Wix.Dashboard.getEditorUrl(function(t){e.$el.find(".openSite").attr("href",t)}))},renderEmailMediaBars:function(){this.$el.find('.ownerEmail:not(".prototype")').each(function(){var e=$(this).find('[name="ownerEmailPart"]').val()||"Email",t='<i class="fa fa-envelope-o"></i>';$(this).find(".mediaBar .title").html(truncate(e,"35")),$(this).find(".mediaBar .image").html(t)})},afterAdd:function(e){e.find('input[type="text"]').val("")},hasConfirmationEmail:function(){for(var e in this.model.get("data"))if(this.model.get("data")[e].sendConfirmationEmail)return!0;return!1}}),formBuilderAppView=appView.extend({beforeInitialize:function(){var e=this,t=JSON.parse(getCookie("Form_"+e.model.meta.id+"_progress")||'{"nonexistent": true}');t&&e.model.setLocals(t),e.formElementsViewModule=new formElementsViewModule(this,{}),e.model.formElementsViewModule=e.formElementsViewModule,e.model.view=e},nextStep:function(){this.formElementsViewModule.saveData(),this.model.get("locals").lastStep&&this.submitForm(),this.formElementsViewModule.renderFormElements("next")},previousStep:function(){this.formElementsViewModule.renderFormElements("previous")},afterCorrectPassword:function(){this.formElementsViewModule.renderFormElements(),this.$el.find("#formBackButton").hide()},afterInitialize:function(){var e=this;this.$el.on("keyup change",".paypalQuantity",function(){var e=$(this).val();(isNaN(e)||parseInt(Number(e))!=e||isNaN(parseInt(e,10))||1>e)&&$(this).val(1)}),this.$el.on("change",'input[type="text"], input[type="date"], input[type="time"], input[type="email"], input[type="password"], input[type="hidden"], input[type="number"], textarea, select, input[type="radio"]:checked, .multipleCheckbox, .checkbox input[type="checkbox"], input.fileURL, input[type="tel"], input[type="url"], input[type="signature"], .addressWrapper',function(t){if("protectionForm"!==$(t.target).parent().prop("id")){var i=$(t.target).closest(".formElement"),a=parseInt(i.prop("id")),n=e.model.attributes.locals.data[a];n&&("multipleCheckbox"===n.type?(n.selectedOptions=[],$(t.target).closest(".formElement").find(":checked").each(function(e,t){n.selectedOptions.push($(t).val())}),n.selectedOptions.length&&(i.removeClass("requiredAndBlank"),i.find("input, textarea, select, label, button").removeClass("requiredAndBlank"),i.find("#"+n.idx.toString()+"_errors").remove())):"radio"===n.type||"select"===n.type||"radioimage"===n.type?(n.selectedOption=$(t.target).closest(".formElement").find(":checked").val(),n.selectedOption&&(i.removeClass("requiredAndBlank"),i.find("input, textarea, select, label, button").removeClass("requiredAndBlank"),i.find("#"+n.idx.toString()+"_errors").remove())):"checkbox"===n.type?(n.checked=$(t.target).prop("checked"),n.checked&&(i.removeClass("requiredAndBlank"),i.find("input, textarea, select, label, button").removeClass("requiredAndBlank"),i.find("#"+n.idx.toString()+"_errors").remove())):"address"===n.type?$(t.target).closest(".formElement").find("input, select").each(function(e,t){n[t.name]=$(t).val(),n[t.name]&&(i.removeClass("requiredAndBlank"),i.find("input, textarea, select, label, button").removeClass("requiredAndBlank"),i.find("#"+n.idx.toString()+"_errors").remove())}):"date"===n.type?$(t.target).closest(".formElement").find("input").each(function(t,a){var r=e.getDateString(a);n[$(a).attr("pwr-mod-attr")]=r,n[$(a).attr("pwr-mod-attr")]&&(i.removeClass("requiredAndBlank"),i.find("input, textarea, select, label, button").removeClass("requiredAndBlank"),i.find("#"+n.idx.toString()+"_errors").remove())}):"signature"===n.type?(n.value=$(t.target).val(),n.src=$(t.target).closest(".formElement").find("img").prop("src")):n.value="url"===n.type?urlFormat($(t.target).val()):$(t.target).val(),(n.value&&"email"!==n.type||"email"===n.type&&n.value.indexOf("@")>-1)&&(i.removeClass("requiredAndBlank"),i.find("#invalidEmail").remove(),i.find("input, textarea, select, label, button").removeClass("requiredAndBlank"),i.find("#"+n.idx.toString()+"_errors").remove()),e.model.formElementsViewModule.updateConditionalElements(),e.model.formElementsViewModule.calculatePrice())}}),this.$el.on("upload_start",".fileUploadInput",function(){e.model.setLocals({upoadInProgress:!0})}),this.$el.on("upload_fail",".fileUploadInput",function(){e.model.setLocals({upoadInProgress:!1})}),this.$el.on("upload_success",".fileUploadInput",function(t){var i=parseInt($(t.target).closest(".formElement").prop("id")),a=e.model.attributes.locals.data[i],n=$(t.target).closest(".formElement").find(".fileURL").val();a.value=n,e.model.setLocals({upoadInProgress:!1})}),this.$el.on("click",".triggerPayment",function(){e.$el.find(".paypalForm ").submit()}),this.$el.on("click","#formBackButton",function(t){t.preventDefault(),e.previousStep()}),this.$el.on("click","#submitButton",function(t){return t.preventDefault(),debug()("Form submit triggered. Event:",t),e.formElementsViewModule.validate()?(e.model.get("captchaRequired")&&!e.model.get("paymentRequired")&&e.model.get("locals").lastStep?""!==grecaptcha.getResponse(e.model.get("locals").captchaID)&&e.submitForm():e.model.get("multistepForm")?e.nextStep():e.submitForm(),!1):!1}),e.model.get("captchaRequired")&&setInterval(function(){if($(".g-recaptcha-bubble-arrow").length>0&&1==$(".g-recaptcha-bubble-arrow").parent().css("opacity")){e.$el.css("height","auto");var t=e.$el.height(),i=.5*$(".g-recaptcha-bubble-arrow").parent().height();e.$el.height(t+i)}else e.$el.css("height","auto")},2e3),this.$el.on("click",".printer",function(){return e.model.get("locals").isDirty||!e.model.meta.saved?void $(".saveModal").modal("show"):void window.open("/plugins/form-builder/view?form-builder-print=true&id="+e.model.meta.id)}),e.model.setLocals({loadTime:(new Date).getTime()}),"wix"==HOST&&this.$el.on("click",".powrMark a",function(){var e=Math.round(.7*screen.width),t=screen.height;return window.open($(this).attr("href"),"","width="+e+",height="+t+",scrollbars=1"),!1})},getDateString:function(e){var t=$(e).closest(".formElement").prop("id"),i=this.model.get("locals").data[t],a=new Date($(e).val()),n=a.getHours(),r=i.istwentyfour?n:n%12===0?12:n%12,o=a.getMinutes();10>o&&(o="0"+o);var s=i.istwentyfour?"":n>12?"PM":"AM";return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()+", "+r+":"+o+s},formatForPrint:function(){if($("html").css("margin","5%"),$(".formBuilder").css("max-width","100%"),$(".formBuilder").css("border","none"),$(".formBuilder").css("text-align","center"),$("#editMe").hide(),$(".formTitle").css("text-align","center"),$(".adminAppInfo").hide(),$(".errors").hide(),$(".printer").hide(),$(".success").hide(),$(".triggerPayment").hide(),$(".formResponses").hide(),$(".resultsButton").hide(),$(".datePickerParent").hide(),$(".submitButton").hide(),$("#spamDetection").hide(),$(".lengthSummary").hide(),$(".description").hide(),$(".honeypot").hide(),$(".stepLabel").hide(),$(".radio").removeClass("radio"),$(".checkbox").removeClass("checkbox"),$("input, textarea").prop("placeholder",""),$('[name="zip"]')[0]){var e=$('[name="zip"]')[0].outerHTML;e=e.replace("zip","country"),$('[name="country"]').replaceWith(e)}$(".fitText").css("display","block"),$(".lengthSummary").hide(),$(".buttonAndSummaryWrapper").hide(),$(".success").hide(),$("input, label, textarea").each(function(e,t){var i=t.getBoundingClientRect().top%1100,a=3*parseFloat($(t).css("height"));(a>i||i>1100-a)&&$(t).css("margin-top",a.toString()+"px")})},setMetaContent:function(){var e=this.model.get(this.model.get("description").length>0?"description":"title"),t=this.model.get("title");this.writeMetaContent(e,t)},paymentsActive:function(){return this.model.get("paymentRequired")&&(parseFloat(this.model.get("locals").fullPrice)>0||this.model.get("paypalAllowUserToSpecifyPrice")&&$.inArray(this.model.get("paypalPurchaseType"),["Donate","BuyNow"])>-1)},getSubmitData:function(){var e=this,t=[];return this.model.get("locals").data.filter(function(e){return-1===$.inArray(e.type,["image","linebreak","step","spacer","label"])}).map(function(i){if(t.push(i.label),e.model.get("includeSkippedFields")||e.formElementsViewModule.elementIsPresent(i)){var a;if("multipleCheckbox"===i.type)a=i.selectedOptions?i.selectedOptions.join(", "):"";else if("radio"===i.type||"select"===i.type||"radioimage"===i.type)a=i.selectedOption;else if("checkbox"===i.type)a=i.checked,void 0===a&&(a=i.defaultChecked?!0:!1);else if("address"===i.type)a=[i.address1,i.address2,i.city,i.state,i.zip,i.country].join(", ");else{if("date"===i.type){if(!e.model.get("includeSkippedFields")&&!i.dateTimeHidden)return;if("date"===i.displayType)try{i.dateTimeHidden=i.dateTimeHidden.split(",")[0]}catch(n){}else if("time"===i.displayType)try{i.dateTimeHidden=i.dateTimeHidden.split(", ")[1]}catch(n){}return i.dateFormat&&"D"===i.dateFormat[0]&&(i.dateTimeHidden=e.euroDate(i.dateTimeHidden)),{label:e.uniqueLabel(t,i),value:i.dateTimeHidden,date_format:i.dateFormat,is_twenty_four:i.istwentyfour,exportField:i.exportField}}a="signature"===i.type?i.src:i.value}if(e.model.get("includeSkippedFields")||void 0!==a)return{label:e.uniqueLabel(t,i),type:i.type,value:a,exportField:i.exportField}}}).filter(function(e){return e})},uniqueLabel:function(e,t){var i=0;return e.forEach(function(e){i+=e===t.label?1:0}),i>1?t.label+"_"+i:t.label},euroDate:function(e){if(e){var t=e.split("/"),i=t[1],a=t[0];return t[0]=i,t[1]=a,t.join("/")}},submitForm:function(){var e=this,t=(this.$el.find(".realForm"),this.$el.find("#submitButton")),i=e.formElementsViewModule.currentPageData(),a=this.getSubmitData();if(e.formElementsViewModule.saveData(),!e.model.get("locals").uploadInProgress&&(debug()(i),!e.formElementsViewModule.preventMultipleSubmission()))if(e.formElementsViewModule.isLastPage()){if(e.model.get("paymentRequired")){var n=Math.floor(1e4*Math.random()+1)+"_"+(d=new Date).getTime();a.push({label:"Quantity",type:"paypalQuantity",value:e.$el.find(".paypalQuantity").val()}),e.$el.find(".paypalForm").find('input[name="quantity"]').val(1),e.$el.find('.paypalForm input[name="custom"]').val(JSON.stringify({response_token:n}))}else var n=null;e.model.setLocals({responseToken:n});var r={appId:e.model.meta.id,data:a,confirmationEmail:e.getConfirmationEmail(a),subscribeEmail:e.getMailchimpSubscribeEmail(),responseToken:e.model.get("locals").responseToken};if(debug()("All data is ",a),e.paymentsActive()){e.$el.find('.powrForm [name="data"]').val(JSON.stringify(r)),e.$el.find(".paypalForm").find('[name="amount"],[name="a3"]').val(e.model.get("locals").fullPrice),e.$el.find('.powrForm [name="paypal_data"]').val(JSON.stringify($(".paypalForm").formToObject())),r.paypal_data=JSON.stringify($(".paypalForm").formToObject()),r.submit_type="form";var o=$.param(r);o.length<2e3&&e.$el.find(".powrForm").attr("action","/app_form_response?"+o),e.$el.find(".powrForm").submit()}else{var s={url:"/app_form_response.json",data:r,type:"POST",buttonElement:t,errorsElement:e.$el.find("#validationErrors")};ajaxController(s,function(t){t.success&&e.afterSubmission()})}if(e.postSizeToSocket(),"wix"==HOST&&"site"==VIEW_MODE){var l="",u="",c="",p=[],h=[],m=[],f=[],g=!1,v=!1,y=!1;for(var _ in a)0==g&&"email"==a[_].type&&a[_].value.length>0?(l=a[_].value,p.push({name:"email",value:l}),h.push({tag:"main",email:l}),g=!0):0==v&&"phone"==a[_].type&&a[_].value.length>0?(u=a[_].value,p.push({name:"phone",value:u}),m.push({tag:"main",phone:u}),v=!0):0==y&&"address"==a[_].type&&a[_].value.length>0?(c=a[_].value,p.push({name:"address",value:c}),y=!0):void 0!=a[_].label&&void 0!=a[_].value&&f.push({name:a[_].label,value:a[_].value});if($.inArray(e.model.meta.app_type,["formBuilder","contactForm","poll","wixDev","localDev","wixLocal"])>-1&&(p.length>0||h.length>0)){var b={type:Wix.Activities.Type.FORM_CONTACT_FORM,info:{content:{},additionalFields:f},details:{additionalInfoUrl:null,summary:"Adding contact from POWr"},contactUpdate:{emails:h,phones:m}};debug()("Sending contact activity to wix: ",b),Wix.Activities.postActivity(b,function(e){debug()("Wix activity success:",e)},function(e){debug()("Wix activity failure:",e)})}if($.inArray(e.model.meta.app_type,["mailingList"])>-1&&l.length>0){var b={type:Wix.Activities.Type.SUBSCRIPTION_FORM,info:{email:l,phone:u},details:{additionalInfoUrl:null,summary:"Adding contact from POWr"},contactUpdate:{emails:h,phones:m}};debug()("Sending subscription activity to wix: ",b),Wix.Activities.postActivity(b,function(e){debug()("Wix activity success:",e)},function(e){debug()("Wix activity failure:",e)})}}}else e.model.setLocals({data:a}),e.formElementsViewModule.renderPage(e.model.get("locals").page+1)},getMailchimpSubscribeEmail:function(){var e=this.model.get("locals").data.filter(function(e){return e.subscribeToMailchimp});return e.length?e[0].value:void 0},getConfirmationEmail:function(){var e=null;return this.model.get("locals").data.forEach(function(t){t.sendConfirmationEmail&&(e=t)}),e?e.value:void 0},afterSubmission:function(){var e=this,t=this.$el.find("#submitButton");e.model.get("preventMultiple")&&setCookie("powr_form_"+e.model.meta.id,"blocked",14),setCookie("Form_"+e.model.meta.id+"_progress",'{"nonexistent": true}',7),t.fadeOut("fast",function(){switch(debug()("Button faded out"),e.model.get("afterSubmission")){case"clearAndPrevent":e.$el.find(".realForm input, .realForm textarea, .realForm select").prop("disabled",!0),e.$el.find(".success").fadeIn("fast"),e.paymentsActive()&&e.$el.find(".triggerPayment").fadeIn();break;case"clearAndAllow":e.model.syncLocalData(!0),e.render(),e.$el.find(".success").fadeIn("fast"),e.$el.find(".triggerPayment").hide();break;case"redirect":if(e.model.get("paymentRequired")&&"redirect"==e.model.get("afterSubmission")&&e.model.get("redirectLink").length>0)e.$el.find(".realForm input, .realForm textarea, .realForm select").prop("disabled",!0),e.$el.find(".success").fadeIn("fast");else{e.render(),debug()("Re-rendering and setting location");var t=urlFormat(e.model.get("redirectLink"));-1==t.indexOf("?")&&(t=t.replace("#","?#")),window.top.location.href=t}e.paymentsActive()&&e.$el.find(".triggerPayment").fadeIn();break;case"hide":e.$el.find(".redirectLink").slideUp(),e.$el.find(".successText").slideUp(),e.$el.find(".formBuilder").slideUp(function(){e.postSizeToSocket()});break;case"responses":e.$el.find(".success").fadeIn("fast"),e.showResponses(),e.paymentsActive()&&e.$el.find(".triggerPayment").fadeIn()}e.postSizeToSocket()})},showResponses:function(){var e=this,t="/form-responses/"+this.model.meta.id+"/show";this.$el.find(".linkResponses a").attr("href",t),e.$el.find(".realForm").find(".dynamicElements").removeClass("visible").slideUp(),e.$el.find(".recaptchaContent").slideUp();var i=e.$el.find(".formResponses");i.slideDown();var a=e.model.get("data").filter(function(e){return!!e.showResponse}),n=a.length;if(0==n);else if(n>1)i.find(".linkResponses").slideDown();else{i.find(".loadingResponses").slideDown();var r=function(e){i.find(".loadingResponses").slideUp(),i.find("#responseChart").show();
var t=i.find("#responseChart").width()>400?"e":"n";jQuery.jqplot("responseChart",e,{seriesDefaults:{renderer:jQuery.jqplot.PieRenderer,rendererOptions:{showDataLabels:!0}},title:a[0].label,legend:{show:!0,location:t},grid:{background:"transparent",borderWidth:0,shadow:!1}})},o=0,s=[],l={url:"/form-responses/"+e.model.meta.id+".json",type:"GET",data:{}};ajaxController(l,function(e){if(e.success){var t={},i=[a[0].label];""==i[0]&&(i=["(No label 1)","(Radio 1)"]);for(var n in e.data)if(e.data.hasOwnProperty(n))for(var l in e.data[n])if(e.data[n].hasOwnProperty(l)){var d=e.data[n][l];debug()("Point",d,i),-1!=i.indexOf(d.label)&&(t[d.value]=t[d.value]+1||1)}for(var n in t)t.hasOwnProperty(n)&&s.push([n,t[n]]);o++,o>=3&&r([s])}}),jQuery.getScript("/public-assets/jqplot.js?body=1").done(function(){o++,o>=3&&r([s]),jQuery.getScript("/public-assets/jqplot.pieRenderer.min.js?body=1").done(function(){o++,o>=3&&r([s])}).fail(function(){})}).fail(function(){}),$("head").append("<link rel='stylesheet' type='text/css' href='/public-assets/jqplot.css?body=1' />")}return{f:r,d:s}},afterRender:function(){this.formElementsViewModule.renderFormElements(),this.updatePowrMarkLink()},updatePowrMarkLink:function(){},buildCaptcha:function(){if(!window.location.href.match("form-builder-print")&&this.model.get("captchaRequired")&&""===$(".captchaImgWrapper").html()){try{var e=grecaptcha.render($(".captchaImgWrapper")[0],{sitekey:"6Le7gisUAAAAAL3VennxOM93GaltIhkqNXlTnCOA"});this.model.setLocals({captchaID:e})}catch(t){}$(".captchaImgWrapper").animate({opacity:1})}},initializeDateTimePickers:function(){function e(e){function i(e,i){var a=e.find(".dateSelector"),n=e.find(".timePicker"),r={using_native_inputs:t,$body:e,use_local:!0,formatString:i,dateSelectEls:a,timeSelectEls:n};new POWrDateTimeComponentWithIncrementer(r).on("change",function(){})}function n(e,i){var n={use_local:!0,formatString:i,using_native_inputs:t,$body:e,dateState:a};new POWrDatePickerComponent(n).on("change",function(e){d.attr("value",e.dateState.toLocaleISOString()),d.val(e.dateState.toLocaleISOString()),$(e).find("input").trigger("change")})}function r(e,i){var n={use_local:!0,formatString:i,using_native_inputs:t,$body:e,timeState:a};new POWrTimePickerComponent(n).on("change",function(e){d.attr("value",e.timeState.toLocaleISOString()),d.val(e.timeState.toLocaleISOString()),$(e).find("input").trigger("change")})}var o,s=e.findAndSelf("[pwr-mod-attr='formatElement']").attr("data-format"),l="data-form-type",d=e.find("input").fxnMap(function(){return $(this)}).filter(function(e){return!!e.attr(l)})[0];switch(o=d.attr(l)){case"datetime":i(e,s);break;case"date":n(e,s);break;case"time":r(e,s);break;default:throw"Bad stuff, couldnt find input type"}d.val(a.toLocaleISOString()),d.attr("value",a.toLocaleISOString())}var t=usingHtml5Datetime(),i=this.$el.find(".datetimeWrapper"),a=moment();i.each(function(){e($(this))})},_initializeDateTimePickers:function(){this.$el.find(".datetimeWrapper").each(function(){function e(){var e=o.find(".datetime");d=e.data("is-twenty-four")||!1;var t=o.find(".ampm").val(),i=new Date;if(usingHtml5Datetime()){var a=o.find(".htmlDate"),n=o.find(".htmlTime"),r=0==a.length?[2e3,1,1]:a.val().split("-");i.setFullYear(parseInt(r[0])||2e3),i.setDate(1),i.setMonth((parseInt(r[1])||1)-1),i.setDate(parseInt(r[2])||1);var s=0==n.length?[0,0]:n.val().split(":");i.setHours(parseInt(s[0])||0),i.setMinutes(parseInt(s[1])||0)}else{if(o.find(".dateSelector").length>0){var l=o.find(".dateSelector").datepicker("getDate");i.setFullYear($.datepicker.formatDate("yy",l)),i.setDate(1),i.setMonth(parseInt($.datepicker.formatDate("m",l))-1),i.setDate($.datepicker.formatDate("d",l)),debug()("Date var",l)}i.setHours(d?parseInt(o.find(".hour").val())||0:"PM"==t?(parseInt(o.find(".hour").val())||0)+12:parseInt(o.find(".hour").val())||0),i.setMinutes(parseInt(o.find(".minute").val())||0)}i.setSeconds(0);var u=o.find(".datetime").data("use-local-time");if(u){i.toLocaleString()}else{i.toString()}e.val(g({date:i,is_twentyfour:d,type:e.data("form-type")})),debug()("Formbuilder Datetime string is "+e.val())}function t(){var t=parseInt(o.find(".hour").val());o.find(".hour").val(23>t&&d?r(t+1):12>t?t+1:d?r(0):1),e()}function i(){var t=parseInt(o.find(".hour").val());o.find(".hour").val(d?t>0?r(t-1):23:t>1?t-1:12),e()}function a(){var t=parseInt(o.find(".minute").val());o.find(".minute").val(59>t?r(t+1):r(0)),e()}function n(){var t=parseInt(o.find(".minute").val());o.find(".minute").val(t>0?r(t-1):r(59)),e()}function r(e){return e.length>1&&10>e?e:(10>e?"0":"")+e}var o=$(this),s=o.find(".datetime").val();if(debug()("Parsing datetime, current value is "+s),0==s.length)var l=new Date;else s.search("am")>-1?s=s.replace("am",""):s.search("pm")>-1&&(s=s.replace(/\d\d:/,function(e){return r(parseInt(e.substr(0,2))+12)+":"}),s=s.replace("pm","")),debug()("Datetime after am/pm parsing: "+s),s.search("/")>-1?l=new Date(s):(l=new Date,l.setHours(s.split(":")[0]),l.setMinutes(s.split(":")[1])),debug()("Datetime Object:",l);var d=o.find(".datetime").data("is-twenty-four")||!1,u=l.getHours(),c=l.getMinutes(),p=Array(3-u.toString().length).join("0")+p;c=Array(3-c.toString().length).join("0")+c;var h=p+":"+c;debug()("Parsed time is "+h+"; datetime obj is",l);var m=d?u:u%12==0?12:u%12,f=d?"":u>12?"PM":"AM";o.find(".hour").val(m),o.find(".minute").val(c),o.find(".ampm").val(f);var g=function(e){debug()("Stringify date called with opts ",e);var t=e.date,i=e.is_twentyfour||!1,a=t.getHours(),n=t.getMinutes(),r=t.getDate(),o=t.getMonth()+1,s=t.getFullYear(),l=i?a:a%12==0?12:a%12,d=i?"":a>12?"pm":"am",u=function(e){var t=2;return e=e.toString(),e.length<t&&(e="0"+e),e},c=""+o+"/"+r+"/"+s,p=""+u(l)+":"+u(n)+d;return"date"==e.type?c:"time"==e.type?p:"datetime"==e.type?c+" "+p:c+" "+p};$(this).find(".dateSelector").datepicker({onSelect:function(){e()}});var v=$(this).find(".dateSelector");v.length>0&&(v.change(function(){e()}),v.datepicker("setDate",l));var y=new Date,_=y.toLocaleTimeString();if(debug()("datestring: "+_),_.match(/am|pm/i)||y.toString().match(/am|pm/i))debug()("12 hour clock");else if(debug()("24 hour clock"),usingHtml5Datetime())o.find(".htmlTime").addClass("twentyfour");else{var u=o.find(".hour");u.addClass("twentyfour"),u.val(r(parseInt(u.val()))),o.find(".ampmPicker").hide()}o.find(".upHour").on("click",function(){t()}),o.find(".downHour").on("click",function(){i()}),o.find(".hour").on("blur",function(){var t=/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/,i=$(this).val(),a=$(this).parents(".datePickerParent").first().hasClass("twentyFour"),n=a?24:12;$(this).val(t.test(i)?i>n?n:i:1),e()}),o.find(".upMinute").on("click",function(){a()}),o.find(".downMinute").on("click",function(){n()}),o.find(".minute").on("blur",function(){var t=/^[+-]?\d+(\.\d+)?([eE][+-]?\d+)?$/,i=$(this).val();$(this).val(t.test(i)?i>59?59:r(i):r(0)),e()}),o.find(".minute").on("keydown",function(e){return 38==e.keyCode?(a(),!1):40==e.keyCode?(n(),!1):void 0}),o.find(".hour").on("keydown",function(e){return 38==e.keyCode?(t(),!1):40==e.keyCode?(i(),!1):void 0}),o.find(".ampm").on("keydown",function(e){return 38==e.keyCode||40==e.keyCode?($(this).val("AM"==$(this).val()?"PM":"AM"),!1):void 0}),o.find(".upAmpm, .downAmpm").on("click",function(){var t=o.find(".ampm").val();debug()(t),o.find(".ampm").val("PM"==t?"AM":"PM"),e()}),o.find(".ampm").on("blur",function(){var t=$(this).val().toUpperCase();$(this).val("PM"!=t&&"AM"!=t?"PM":t),e()}),e()})}})}),$(function(){if($("#apps-view, #apps-facebook_view").length>0&&(loadView(),loadViewListeners()),$("#apps-cached_view").length>0)if(debug()("In apps cached view"),loadViewListeners(),"async"==getURLParameter("load"))debug()("Async loading"),LOAD_ME_INTERVAL=setInterval(function(){if("undefined"==typeof META||void 0==META){if("undefined"!=typeof PARENT_ORIGIN&&"undefined"!=typeof IFRAME_INDEX){var e={message:"loadMe",data:{iframe_index:IFRAME_INDEX}};parent.postMessage(JSON.stringify(e),PARENT_ORIGIN)}}else clearInterval(LOAD_ME_INTERVAL)},5e3);else{var e="/plugins/"+APP_DETAILS.slug+"/view.json?";e+=getURLParameter("id")?"id="+getURLParameter("id"):getURLParameter("unique_label")?"unique_label="+getURLParameter("unique_label")+"&powr_token="+getURLParameter("powr_token")+"&user_label="+getURLParameter("user_label"):"powr_token="+getURLParameter("powr_token")+"&user_label="+getURLParameter("user_label"),getURLParameter("external_type")&&(e+="&external_type="+getURLParameter("external_type")),debug()("Calling to get app json. Url is "+e),ajaxController({url:e,type:"GET"},function(e){e.success?(debug()("Success getting view data"),META=e.meta,GLOBALS=e.globals,CONTENT=e.content,loadView()):debug()("Error getting view data")})}if($("#apps-wix_view").length>0&&initializeWix(),$("#apps-wix_cached_view").length>0){var e="/plugins/"+APP_DETAILS.slug+"/wix_view.json?"+originalQuery();ajaxController({url:e,type:"GET"},function(e){e.success?(META=e.meta,GLOBALS=e.globals,VIEW_MODE=Wix.Utils.getViewMode(),"site"!=VIEW_MODE?BACKUP_CONTENT=e.content:CONTENT=e.content,initializeWix()):debug()("Error getting wix view data")})}}),POWrDatePickerComponent.prototype={ModuleName:"POWrDatePickerComponent",handleNativeInputs:function(){var e=this.$body;e.on("change",function(e){var t=$(e.target).val(),i=t.split("-"),a=i[0],n=i[1]-1,r=i[2];this.dateState.year(a),this.dateState.month(n),this.dateState.date(r),this.trigger("change")}.bind(this))},setDateState:function(e){this.dateState=e?moment_custom(e):moment_custom(),this.setDateInput()},setFormat:function(e){if(!e)throw"You messed up here";this.formatString=e,this.setDateInput();var t="MM-DD-YYYY"===this.formatString?"mm-dd-yy":"dd-mm-yy";this.$datePickerContainer.datepicker("option","dateFormat",t),this.setDateInput()},setDateInput:function(){this.dateState||this.setDateState();var e=this.dateState.format(this.formatString,this.use_local);this.$datePickerContainer.datepicker("option","dateFormat","MM-DD-YYYY"===this.formatString?"mm-dd-yy":"dd-mm-yy"),this.$datePickerContainer.datepicker("setDate",e)},_setYear:function(e){this.dateState.year(e)},_setMonth:function(e){this.dateState.month(e)},_setDay:function(e){this.dateState.date(e)},_changeDate:function(e){var t=moment_custom(e),i={year:t.get("year"),month:t.get("month"),date:t.get("date"),hour:t.get("hour"),minute:t.get("minute"),second:t.get("second"),millisecond:t.get("millisecond")};this.dateState=moment_custom(i),this.setDateInput()},_handlers:{jqueryCalChange:function(e,t,i){var a=i.$datePickerContainer.datepicker("getDate");i._setMonth(a.getUTCMonth()),i._setDay(a.getUTCDate()),i.setDateState(a),i.trigger("change")}},_html:function(){return['<input type="text" class="form-control ignore user-success" pwr pwr-mod-attr="datePickerContainer">'].join("\n")}()},POWrTimePickerComponent.prototype={ModuleName:"POWrTimePickerComponent",handleNativeInputs:function(){var e=this.$body.findAndSelf('[type="time"]');e.on("change",function(e){var t=$(e.target).val(),i=t.split(":"),a=i[0],n=i[1];this.timeState.hour(a,this.use_local),this.timeState.minute(n,this.use_local),this.trigger("change")}.bind(this)),this.timeState=moment_custom()},disable:function(){this.$minuteInput.attr("disabled","disabled"),this.$hourInput.attr("disabled","disabled"),this.$amPmInput.attr("disabled","disabled")},enable:function(){this.$minuteInput.removeAttr("disabled"),this.$hourInput.removeAttr("disabled"),this.$amPmInput.removeAttr("disabled")},setTimeState:function(e){return this.timeState=moment_custom(e||moment_custom()),this._setInputs(),this},_setInputs:function(){this._setHourInput(),this._setMinuteInput(),this._setAMPMInput()},_setHourInput:function(){var e=this.timeState.hours(null,this.use_local),t=this.is_twentyfour();if(e>12)var e=t?e:e-12;0!==e||t||(e=12),this.$hourInput.val(this.pad2(e))},_setMinuteInput:function(){var e=this.timeState.minutes(null,this.use_local);this.$minuteInput.val(this.pad2(e))},_setAMPMInput:function(){var e=this.timeState.format("A",this.use_local);this.$amPmInput.val(this.pad2(e))},_alternateAMPM:function(){var e=this.timeState.format("A",this.use_local),t="PM"===e?-12:12;this.timeState.add(t,"hours"),this._setAMPMInput()},_incrementHour:function(){var e=this.timeState.hours(null,this.use_local),t=this.is_twentyfour();e===(t?23:12)?this.timeState.hours(1,this.use_local):this.timeState.hours(e+1,this.use_local),this._setHourInput(),this.trigger("change")},_decrementHour:function(){var e=this.timeState.hours(null,this.use_local);0===e?this.timeState.hours(23,this.use_local):this.timeState.hours(e+-1,this.use_local),this._setHourInput(),this.trigger("change")},_incrementMinute:function(){var e=this.timeState.minutes(null,this.use_local);this.timeState.minutes(59===e?0:e+1),this._setMinuteInput(),this.trigger("change")},_decrementMinute:function(){var e=this.timeState.minutes(null,this.use_local);0===e?this.timeState.minutes(59,this.use_local):this.timeState.minutes(this.timeState.minutes(null,this.use_local)+-1,this.use_local),this._setMinuteInput(),this.trigger("change")},hourInputValidate:function(e){var t=parseInt(e);if(isNaN(t))return e;var i;return numberRegex.test(t)?t>12&&(i=12):i=1,i},minuteInputValidate:function(e){var t=parseInt(e);if(isNaN(t))return e;var i;return i=numberRegex.test(t)?t>59?59:this.pad2(t):"00"},amPmInputValidate:function(e){var t=e.toUpperCase();return"PM"!=t&&"AM"!=t&&(t="PM"),t},keydownMinuteInput:function(e){return 38==e.keyCode?(this._incrementMinute(),!0):40==e.keyCode?(this._decrementMinute(),!0):void 0},keydownHourInput:function(e){return 38==e.keyCode?(this._incrementHour(),!0):40==e.keyCode?(this._decrementHour(),!0):void 0},keydownAmPmInput:function(e){return 38==e.keyCode||40==e.keyCode?(this._alternateAMPM(),!0):void 0},_exec_handler:function(e){var t=this;return function(i){t._handlers[e](i,this,t),t.trigger("change")}},_handlers:{hourInputKeyBlur:function(e,t,i){if(!i.keydownHourInput(e)){{var a=parseInt($(t).val());!isNaN(a)}isNaN(parseInt(a))||i.timeState.hour(a,i.use_local),i._setInputs()}},minuteInputKeyBlur:function(e,t,i){if(!i.keydownMinuteInput(e)){var a=$(t),n=parseInt(a.val()),r=!isNaN(n),o=60>=n;r&&o&&i.timeState.minute(n,i.use_local),i._setInputs()}},amPmInputKeyBlur:function(e,t,i){if(!i.keydownAmPmInput(e)){var a=$(t),n=i.amPmInputValidate(a.val()),r=i.timeState.format("A");if(n!==r){var o="PM"===r?-12:12;i.timeState.add(o,"hours"),i._setInputs()}}},incrementHourClick:function(e,t,i){i._incrementHour()},decrementHourClick:function(e,t,i){i._decrementHour()},incrementMinuteClick:function(e,t,i){i._incrementMinute()},decrementMinuteClick:function(e,t,i){i._decrementMinute()},ampPmToggleClick:function(e,t,i){i._alternateAMPM()}},_initializers:{$timeSelectorEl:function(e){var t=e.$timeSelectorEl,i=new Date,a=i.getHours()+":"+i.getMinutes(),n=[{label:"0:00 (12 am)",value:0},{label:"1:00 (1 am)",value:1},{label:"2:00 (2 am)",value:2},{label:"3:00 (3 am)",value:3},{label:"4:00 (4 am)",value:4},{label:"5:00 (5 am)",value:5},{label:"6:00 (6 am)",value:6},{label:"7:00 (7 am)",value:7},{label:"8:00 (8 am)",value:8},{label:"9:00 (9 am)",value:9},{label:"10:00 (10 am)",value:10},{label:"11:00 (11 am)",value:11},{label:"12:00 (12 pm)",value:12},{label:"13:00 (1 pm)",value:13},{label:"14:00 (2 pm)",value:14},{label:"15:00 (3 pm)",value:15},{label:"16:00 (4 pm)",value:16},{label:"17:00 (5 pm)",value:17},{label:"18:00 (6 pm)",value:18},{label:"19:00 (7 pm)",value:19},{label:"20:00 (8 pm)",value:20},{label:"21:00 (9 pm)",value:21},{label:"22:00 (10 pm)",value:22},{label:"23:00 (11 pm)",value:23},{label:"24:00 (12 pm)",value:24}];t.autocomplete({appendTo:self.$el,source:n,minLength:0,change:function(){e.__updateDatetime()}}),t.focus(function(){$(this).autocomplete("search","")}),t.on("click",function(){$(this).autocomplete("search","")}),t.val(a)}},is_twentyfour:function(){return!!this.$amPmInput.attr("data-istwentyfour")},execInitializer:function(e,t){this._initializers[e](t)},pad2:function(e){return e.length>1&&10>e?e:(10>e?"0":"")+e},_html:function(){return['<div class="timePicker" pwr pwr-mod-attr="timepickers">','<div class="hourPicker">','<div class="upHour timeArrow" unselectable="on" pwr pwr-mod-attr="incrementHour" pwr-handler="incrementHourClick"><i class="fa fa-caret-up"></i></div>','<input type="text" class="hour ignoreThis" value="1" pwr pwr-mod-attr="hourInput" pwr-handler-event="blur" pwr-handler="hourInputKeyBlur">','<div class="downHour timeArrow" unselectable="on" pwr pwr-mod-attr="decrementHour" pwr-handler="decrementHourClick"><i class="fa fa-caret-down"></i></div>',"</div>",'<div class="colon">:</div>','<div class="minutePicker">','<div class="upMinute timeArrow" unselectable="on" pwr pwr-mod-attr="incrementMinute" pwr-handler="incrementMinuteClick"><i class="fa fa-caret-up"></i></div>','<input type="text" class="minute ignoreThis" value="00" pwr pwr-mod-attr="minuteInput" pwr-handler-event="blur" pwr-handler="minuteInputKeyBlur">','<div class="downMinute timeArrow" unselectable="on" pwr pwr-mod-attr="decrementMinute" pwr-handler="decrementMinuteClick"><i class="fa fa-caret-down"></i></div>',"</div>",'<div class="ampmPicker" pwr pwr-mod-attr="ampmPickerContainer">','<div class="upAmpm timeArrow" unselectable="on" pwr pwr-mod-attr="ampmToggle" pwr-handler="ampPmToggleClick"><i class="fa fa-caret-up"></i></div>','<input type="text" class="ampm ignoreThis" pwr pwr-mod-attr="amPmInput" pwr-handler-event="blur" pwr-handler="amPmInputKeyBlur">','<div class="downAmpm timeArrow" unselectable="on" pwr pwr-mod-attr="ampmToggle" pwr-handler="ampPmToggleClick"><i class="fa fa-caret-down"></i></div>',"</div>","</div>"].join("\n")}()},POWrDateTimeComponentWithIncrementer.prototype={ModuleName:"POWrDateTimeComponentWithIncrementer",_init:function(){this.using_native_inputs||(this._setDateInput(),this._setTimeComponent(),this._setHiddenInput())},setDateTimeState:function(e){this.dateTimeState=moment_custom(e),this._init()},_setDateInput:function(){this.dateComponent.setDateState(this.dateTimeState)},_setTimeComponent:function(){this.timeComponent.setTimeState(this.dateTimeState)},_setHiddenInput:function(){var e=this.use_local?this.dateTimeState.toLocaleISOString():this.dateTimeState.toISOString();this.$dateTimeHidden.attr("value",e),this.$dateTimeHidden.val(e),this.$dateTimeHidden.trigger("change")},setFormat:function(e){if(!e)throw"Bad things";this.formatString=e,this.$dateTimeFormatHidden.attr("value",e),this.$dateTimeFormatHidden.val(e),this.$dateTimeFormattedHidden.attr("value",this.dateTimeState.format(e)),this.$dateTimeFormattedHidden.val(this.dateTimeState.format(e)),this._setHiddenInput(),this.dateComponent.setFormat(this.formatString),this.trigger("change"),this.$dateTimeFormatHidden.trigger("change")},_html:function(){return["<div>",'<div pwr pwr-mod-attr="datePickerContainer" type="text">',"</div>",'<div pwr pwr-mod-attr="timePickerContainer" type="text">',"</div>",'<div pwr pwr-mod-attr="formatPickerContainer" type="text">',"</div>",'<input pwr pwr-mod-attr="dateTimeHidden" style="display:none;" type="text">','<input pwr pwr-mod-attr="dateTimeFormatHidden" style="display:none;" type="text">','<input pwr pwr-mod-attr="dateTimeFormattedHidden" style="display:none;" type="text">',"</div>"].join("\n")}()},function e(t,i,a){function n(o,s){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(r)return r(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return n(i?i:e)},u,u.exports,e,t,i,a)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<a.length;o++)n(a[o]);return n}({1:[function(e,t){t.exports=function(e,t){return function(i){setTimeout(function(){e(i)},t)}}},{}],2:[function(e,t){t.exports=function(e,t,i){var a="s"===i.slice(-1)?i.slice(0,-1):i,n=new Date(e);switch(a.toLowerCase()){case"year":n.setFullYear(n.getFullYear()+t);break;case"quarter":n.setMonth(n.getMonth()+3*t);break;case"month":n.setMonth(n.getMonth()+t);break;case"week":n.setDate(n.getDate()+7*t);break;case"day":n.setDate(n.getDate()+t);break;case"hour":n.setTime(n.getTime()+36e5*t);break;case"minute":n.setTime(n.getTime()+6e4*t);break;case"second":n.setTime(n.getTime()+1e3*t);break;default:n=new Date(0/0)}return n}},{}],3:[function(e){window.moment_custom=e("./momentlte.js"),window.moment=e("./momentlte.js")},{"./momentlte.js":6}],4:[function(e,t){function i(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}function a(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var i=new Date(t.getFullYear(),0,4);i.setDate(i.getDate()-(i.getDay()+6)%7+3);var a=t.getTimezoneOffset()-i.getTimezoneOffset();t.setHours(t.getHours()-a);var n=(t-i)/6048e5;return 1+Math.floor(n)}function n(e){var t=e.getDay();return 0===t&&(t=7),t}function r(e){return null===e?"null":void 0===e?"undefined":"object"!=typeof e?typeof e:Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}function o(){var e=/([YyMmDdSsH]{1,4})|([h]){1,2}|([AaoZ])/g;return function(t,d,u){var c=!u;if(1!==arguments.length||"string"!==r(t)||/\d/.test(t)||(d=t,t=void 0),t=t||new Date,t instanceof Date||(t=new Date(t)),isNaN(t))return new Date(t);d=String(o.masks[d]||d||o.masks["default"]);var p=c?"getUTC":"get",h=t[p+"Date"](),m=t[p+"Day"](),f=t[p+"Month"](),g=t[p+"FullYear"](),v=t[p+"Hours"](),y=t[p+"Minutes"](),_=t[p+"Seconds"](),b=t[p+"Milliseconds"](),w=c?0:t.getTimezoneOffset(),k=a(t),D=n(t),M={Q:"TO BE IMPLEMENTED",Qo:"TO BE IMPLEMENTED",Do:s(h),D:h,DD:i(h),DDD:"TO BE IMPLEMENTED",d:m,dd:i(m),ddd:o.i18n.dayNames[h],dddd:o.i18n.dayNames[h]+"day",m:y,mm:i(y),M:f+1,Mo:s(f+1),MM:i(f+1),MMM:o.i18n.monthNames[f].slice(0,3),MMMM:o.i18n.monthNames[f],YY:String(g).slice(2),yy:String(g).slice(2),yyyy:g,YYYY:g,h:v%12||12,hh:i(v%12||12),H:v,HH:i(v),M:f,s:_,ss:i(_),l:i(b,3),L:i(Math.round(b/10)),A:12>v?"AM":"PM",a:12>v?"AM":"PM",Z:w?l(w):"Z",S:["th","st","nd","rd"][m%10>3?0:(m%100-m%10!=10)*m%10],W:k,N:D};return d.replace(e,function(e){return e in M?M[e]:e.slice(1,e.length-1)})}}var s=e("./ordinalSuffix.js"),l=e("./offsetFix.js");o.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},o.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]},t.exports=o()},{"./offsetFix.js":7,"./ordinalSuffix.js":8}],5:[function(e,t){var i=function(){var e=(Date.parse,[1,4,5,6,7,10,11]);return function(t){var i,a,n=0;if(!(a=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(t)))return console.warn("Bad date object passed",t),new Date;for(var r,o=0;r=e[o];++o)a[r]=+a[r]||0;return a[2]=(+a[2]||1)-1,a[3]=+a[3]||1,"Z"!==a[8]&&void 0!==a[9]&&(n=60*a[10]+a[11],"+"===a[9]&&(n=0-n)),i=Date.UTC(a[1],a[2],a[3],a[4],a[5]+n,a[6],a[7]),new Date(i)}}();t.exports=i},{}],6:[function(e,t){function i(e){var t="string"==typeof e?TYPE.STRING:null,i="[object Date]"===Object.prototype.toString.call(e)?TYPE.DATE:null,e="object"==typeof e?TYPE.OBJECT:null,a=("function"==typeof e&&e._isAMomentObject?TYPE.MOMENT:null,"function"==typeof e?TYPE.FUNCTION:null);return[t,i,e,a].reduce(function(e,t){return e?e:t})}function a(e){return null!=e||!!e}var n=e("./format.js"),r=e("./fromISOString.js"),o=e("./arbitrator.js"),s=e("./changeDate.js"),l=e("./offsetFix.js");TYPE={STRING:"STRING",DATE:"DATE",OBJECT:"OBJECT",MOMENT:"MOMENT",FUNCTION:"FUNCTION"};var d=function(e){var t,d=i(e);switch(d){case TYPE.STRING:t=r(e);break;case TYPE.DATE:t=new Date(e);break;case TYPE.OBJECT:t=new Date(e.year,e.month,e.date,e.hours,e.minutes,e.seconds,e.milliseconds);break;case TYPE.MOMENT:t=new Date(e._d);break;case TYPE.NUMBER:throw"We dont support numbers.";default:t=new Date}var u=function(e){var a=i(e);if(a===TYPE.DATE)t=e;else{if(a===TYPE.OBJECT)return Object.keys(e).forEach(function(t){u[t](e[t])}),u;t=new Date}return u};return u._d=t,u._isAMomentObject=!0,u.every=function(e,t,i){var a=o(i,1e3*e);return a},u.add=function(e,i){return t=s(t,e,i),u._d=t,u},u.minus=function(e,t){return u.add(-1*e,t)},u.toLocaleISOString=function(){var e=n(t,"YYYY-MM-DDTHH:mm:ss",!0),i=t.getTimezoneOffset(),a=l(i);return e+a},u.toISOString=function(){return u.format("yyyy-MM-DDTHH:mm:ssZ")},u.format=function(e,i){return n(t,e,i)},u.valueOf=function(){return+t},u.get=u.set=function(e,t){return i(e)===TYPE.OBJECT?(Object.keys(e).forEach(function(t){u.set(t,e[t])}),u):a(t)?u[e](t):u[e]()},u.year=u.years=function(e,i){var n=a(e),r=n?"set":"get",o=i?"":"UTC",s="FullYear",l=r+o+s;return n?(t[l](e),u):t[l]()},u.month=u.months=function(e,i){var n=a(e),r=n?"set":"get",o=i?"":"UTC",s="Month",l=r+o+s;return n?(t[l](e),u):t[l]()},u.date=u.dates=function(e,i){var n=a(e),r=n?"set":"get",o=i?"":"UTC",s="Date",l=r+o+s;return n?(t[l](e),u):t[l]()},u.hour=u.hours=function(e,i){var n=a(e),r=n?"set":"get",o=i?"":"UTC",s="Hours",l=r+o+s;return n?(t[l](e),u):t[l]()},u.minute=u.minutes=function(e,i){var n=a(e),r=n?"set":"get",o=i?"":"UTC",s="Minutes",l=r+o+s;return n?(t[l](e),u):t[l]()},u.second=u.seconds=function(e,i){var n=a(e),r=n?"set":"get",o=i?"":"UTC",s="Seconds",l=r+o+s;return n?(t[l](e),u):t[l]()},u.millisecond=u.milliseconds=function(e,i){var n=a(e),r=n?"set":"get",o=i?"":"UTC",s="Milliseconds",l=r+o+s;return n?(t[l](e),u):t[l]()},u.localYear=u.localYears=function(){return t.getFullYear()},u.localMonth=u.localMonths=function(){return t.getMonth()},u.localDate=u.localDates=function(){return t.getDate()},u.localHour=u.localHours=function(){return t.getHours()},u.localMinute=u.localMinutes=function(){return t.getMinutes()},u.localSecond=u.localSeconds=function(){return t.getSeconds()},u.localMillisecond=u.localMilliseconds=function(){return t.getMilliseconds()},u};t.exports=d},{"./arbitrator.js":1,"./changeDate.js":2,"./format.js":4,"./fromISOString.js":5,"./offsetFix.js":7}],7:[function(e,t){function i(e){function t(e){var t=0>e,e=t?-1*e:e;return 10>e?"0"+e:e}var e=parseInt(e);if(!e)return"+00:00";var i=0>e,e=i?-1*e:e,a=Math.floor(e/60),n=e%60,r=t(a),o=t(n),s=r+":"+o;return(i?"+":"-")+s}t.exports=i},{}],8:[function(e,t){t.exports=function(e){var t=["th","st","nd","rd"],i=e%100;return e+(t[(i-20)%10]||t[i]||t[0])}},{}]},{},[3]);